WA2893 Booz Allen Hamilton
Tech Excellence Modern
Software Development
Program - Phase 2
Web Age Solutions Inc.
USA: 1-877-517-
Canada: 1-877-812-
Web: http://www.webagesolutions.com
The following terms are trademarks of other companies:

Java and all Java-based trademarks and logos are trademarks or registered trademarks of
Sun Microsystems, Inc. in the United States, other countries, or both.

Microsoft, Windows, Windows NT, and the Windows logo are trademarks of Microsoft
Corporation in the United States, other countries, or both.

UNIX is a registered trademark of The Open Group in the United States and other
countries.

Linux is a trademark of Linus Torvalds in the United States, other countries, or both.

IBM, WebSphere, DB2 and Tivoli are trademarks of the International Business Machines
Corporation in the United States, other countries, or both.

Other company, product, and service names may be trademarks or service marks of
others.

For customizations of this book or other sales inquiries, please contact us at:
USA: 1-877-517-6540, email: getinfousa@webagesolutions.com
Canada: 1-877-812-8887 toll free, email: getinfo@webagesolutions.com
Copyright © 2023 Web Age Solutions Inc.

This publication is protected by the copyright laws of Canada, United States and any
other country where this book is sold. Unauthorized use of this material, including but not
limited to, reproduction of the whole or part of the content, re-sale or transmission
through fax, photocopy or e-mail is prohibited. To obtain authorization for any such
activities, please write to:

Web Age Solutions Inc.
821A Bloor Street West
Toronto
Ontario, M6G 1M

Table of Contents
Chapter 1 - DevOps Fundamentals....................................................................................
1.1 Why DevOps?........................................................................................................
1.2 What is DevOps?....................................................................................................
1.3 What is DevOps?....................................................................................................
1.4 What is DevOps?....................................................................................................
1.5 Collaborative, Matrixed and Cross-Functional Teams..........................................
1.6 Key Components of Successful DevOps Teams....................................................
1.7 DevOps-ification....................................................................................................
1.8 DevOps Vocabulary...............................................................................................
1.9 DevOps Goals........................................................................................................
1.10 Not DevOps - Crush Buzzwords..........................................................................
1.11 Driving Business Outcomes with DevOps...........................................................
1.12 Technology-Enabled Business.............................................................................
1.13 DevOps Key Enabler for Digital Transformation................................................
1.14 Core Values and Mission.....................................................................................
1.15 Core Values - Culture...........................................................................................
1.16 Core Values - Automation...................................................................................
1.17 Core Values - Measurement.................................................................................
1.18 Core Values - Sharing..........................................................................................
1.19 Communication....................................................................................................
1.20 Collaboration........................................................................................................
1.21 Value Stream Mapping........................................................................................
1.22 Behavioral Patterns for Success...........................................................................
1.23 DevOps Org Structures........................................................................................
1.24 DevOps Team - Separate.....................................................................................
1.25 DevOps Merged Organization.............................................................................
1.26 DevOps Overlapped Organization.......................................................................
1.27 Organizational Structure Leadership....................................................................
1.28 Summary..............................................................................................................
Chapter 2 - Introduction to Git Flow.................................................................................
2.1 Why Use an SCM Workflow?...............................................................................
2.2 Why Use an SCM Workflow? (Cond.)..................................................................
2.3 What is Git Flow....................................................................................................
2.4 The Main Branch....................................................................................................
2.5 Benefits..................................................................................................................
2.6 How Git Flow works?............................................................................................
2.7 How Git Flow works? (Contd.)..............................................................................
2.8 What is Git Flow? (Contd.)....................................................................................
2.9 How Git Flow works? (Contd.)..............................................................................
2.10 How Git Flow works? (Contd.)............................................................................
2.11 Git Flow Extension..............................................................................................
2.12 Initializing Git Flow.............................................................................................
2.13 Features................................................................................................................
2.14 Release.................................................................................................................
2.15 Hotfixes................................................................................................................
2.16 Git Flow and Continuous Integration...................................................................
2.17 Git Flow – Summary............................................................................................
2.18 Git Flow – Pros and Cons....................................................................................
2.19 Git Flow – When it Works Best?.........................................................................
2.20 Git Flow – When it Doesn’t Work?.....................................................................
2.21 Git Flow Alternatives...........................................................................................
2.22 Trunk-based Development...................................................................................
2.23 Trunk-based Development (Contd.).....................................................................
2.24 Trunk-based Development – When it Works?.....................................................
2.25 Trunk-based Development – When it Doesn’t Work?.........................................
2.26 GitHub Flow.........................................................................................................
2.27 GitHub Flow – Pros and Cons.............................................................................
2.28 GitLab Flow.........................................................................................................
2.29 GitLab Flow – Environment Branches................................................................
2.30 GitLab Flow – Release Branches.........................................................................
2.31 GitLab Flow – Release Branches (Contd.)..........................................................
2.32 GitLab Flow – Pros and Cons..............................................................................
2.33 Summary..............................................................................................................
Chapter 3 - Breaking Up Monoliths – Pros and Cons.......................................................
3.1 Traditional Monolithic Applications and Their Place............................................
3.2 Disadvantages of Monoliths...................................................................................
3.3 Developer's Woes...................................................................................................
3.4 Architecture Modernization...................................................................................
3.5 Architecture Modernization Challenges................................................................
3.6 Microservices Architecture is Not a Silver Bullet!................................................
3.7 What May Help?....................................................................................................
3.8 In-Class Discussion................................................................................................
3.9 Summary................................................................................................................
Chapter 4 - Twelve-factor Applications............................................................................
4.1 Twelve-factor Applications....................................................................................
4.2 Twelve Factors, Microservices, and App Modernization......................................
4.3 The Twelve Factors................................................................................................
4.4 Categorizing the 12 Factors...................................................................................
4.5 12-Factor Microservice Codebase..........................................................................
4.6 12-Factor Microservice Dependencies...................................................................
4.7 12-Factor Microservice Config..............................................................................
4.8 12-Factor Microservice Backing Services.............................................................
4.9 12-Factor Microservice Build, Release, Run.........................................................
4.10 12-Factor Microservice Processes........................................................................
4.11 12-Factor Microservice Port Binding...................................................................
4.12 12-Factor Microservice Concurrency..................................................................
4.13 12-Factor Microservice Disposability..................................................................
4.14 12-Factor Microservice Dev/Prod Parity.............................................................
4.15 12-Factor Microservice Logs...............................................................................
4.16 12-Factor Microservice Admin Processes...........................................................
4.17 Summary..............................................................................................................
Chapter 5 - Microservice Development.............................................................................
5.1 What are Microservices?........................................................................................
5.2 Microservices vs Classic SOA...............................................................................
5.3 Principles of Microservices Architecture Design..................................................
5.4 Domain-Driven Design..........................................................................................
5.5 Domain-Driven Design - Benefits.........................................................................
5.6 Microservices and Domain-Driven Design............................................................
5.7 Designing for failure..............................................................................................
5.8 Microservices Architecture – Pros.........................................................................
5.9 Microservices Architecture – Cons........................................................................
5.10 Docker and Microservices....................................................................................
5.11 Microservice Deployment with Docker – Workflow...........................................
5.12 Writing Dockerfile...............................................................................................
5.13 Kubernetes............................................................................................................
5.14 What is OpenShift................................................................................................
5.15 OpenShift Architecture........................................................................................
5.16 Microservices and Various Applications.............................................................
5.17 Web Applications.................................................................................................
5.18 Web Applications – Reference Architecture........................................................
5.19 Web Applications – When to use?.......................................................................
5.20 Single Page Applications.....................................................................................
5.21 Single Page Applications – Benefits....................................................................
5.22 Traditional Enterprise Application Architecture..................................................
5.23 Sample Microservices Architecture.....................................................................
5.24 Serverless & Event-driven Microservice – AWS Lambda..................................
5.25 Summary..............................................................................................................
Chapter 6 - Introduction to Spring Boot............................................................................
6.1 What is Spring Boot?.............................................................................................
6.2 Spring Framework..................................................................................................
6.3 How is Spring Boot Related to Spring Framework?..............................................
6.4 Spring Boot 2.........................................................................................................
6.5 Spring Boot Main Features....................................................................................
6.6 Spring Boot on the PaaS........................................................................................
6.7 Understanding Java Annotations............................................................................
6.8 Spring MVC and REST Annotations.....................................................................
6.9 Example of Spring MVC-based RESTful Web Service........................................
6.10 Spring Booting Your RESTful Web Service.......................................................
6.11 Spring Boot Skeletal Application Example.........................................................
6.12 Starters..................................................................................................................
6.13 Maven - The 'pom.xml' File.................................................................................
6.14 Maven - The 'pom.xml' File.................................................................................
6.15 Spring Boot Maven Plugin...................................................................................
6.16 Gradle - The 'build.gradle' File............................................................................
6.17 Spring Boot Gradle Plugin...................................................................................
6.18 HOWTO: Create a Spring Boot Application.......................................................
6.19 HOWTO: Create a Spring Boot Application.......................................................
6.20 Spring Initializr....................................................................................................
6.21 Spring Initializr....................................................................................................
6.22 Summary..............................................................................................................
Chapter 7 - Overview of Spring Boot Database Integration..............................................
7.1 DAO Support in Spring..........................................................................................
7.2 DAO Support in Spring..........................................................................................
7.3 Spring Data Access Modules.................................................................................
7.4 Spring JDBC Module.............................................................................................
7.5 Spring ORM Module..............................................................................................
7.6 Spring ORM Module..............................................................................................
7.7 DataAccessException.............................................................................................
7.8 DataAccessException.............................................................................................
7.9 @Repository Annotation........................................................................................
7.10 Using DataSources...............................................................................................
7.11 DAO Templates...................................................................................................
7.12 DAO Templates and Callbacks............................................................................
7.13 ORM Tool Support in Spring...............................................................................
7.14 Summary..............................................................................................................
Chapter 8 - Using Spring with JPA....................................................................................
8.1 Spring JPA.............................................................................................................
8.2 Benefits of Using Spring with ORM....................................................................
8.3 Spring @Repository.............................................................................................
8.4 Using JPA with Spring.........................................................................................
8.5 Configure Spring Boot JPA EntityManagerFactory............................................
8.6 Application JPA Code..........................................................................................
8.7 Spring Boot Considerations.................................................................................
8.8 Spring Data JPA Repositories..............................................................................
8.9 Spring Data JPA Repositories..............................................................................
8.10 Database Schema Migration..............................................................................
8.11 Database Schema Migration for CI/CD using Liquibase...................................
8.12 How Liquibase Works?......................................................................................
8.13 Changelogs in Liquibase....................................................................................
8.14 Preconditions in Changelogs..............................................................................
8.15 Sample Empty Changelog..................................................................................
8.16 Sample Precondition in Changelog....................................................................
8.17 Sample Changeset in Changelog........................................................................
8.18 Running Liquibase.............................................................................................
8.19 Liquibase Commands.........................................................................................
8.20 Summary............................................................................................................
Chapter 9 - Spring REST Services...................................................................................
9.1 REpresentational State Transfer...........................................................................
9.2 Principles of RESTful Services............................................................................
9.3 Understanding REST...........................................................................................
9.4 Understanding REST...........................................................................................
9.5 REST Example – Create......................................................................................
9.6 REST Example – Retrieve...................................................................................
9.7 REST Example – Update.....................................................................................
9.8 REST Example – Delete......................................................................................
9.9 REST Example – Client Generated ID................................................................
9.10 REST Example – JSON.....................................................................................
9.11 @RestController Annotation..............................................................................
9.12 HTTP Request Method Mapping.......................................................................
9.13 Path Variables and Query Parameters................................................................
9.14 RequestBody and ResponseBody......................................................................
9.15 JAX-RS vs Spring..............................................................................................
9.16 Java Clients Using RestTemplate.......................................................................
9.17 RestTemplate Methods.......................................................................................
9.18 RestTemplate Example......................................................................................
9.19 Testing with Postman.........................................................................................
9.20 Summary............................................................................................................
Chapter 10 - Spring Security............................................................................................
10.1 Securing Web Applications with Spring Boot 2................................................
10.2 Spring Security...................................................................................................
10.3 Authentication and Authorization......................................................................
10.4 Programmatic vs Declarative Security...............................................................
10.5 Adding Spring Security to a Project...................................................................
10.6 Spring Security Configuration...........................................................................
10.7 Spring Security Configuration Example............................................................
10.8 Authentication Manager.....................................................................................
10.9 Using Database User Authentication.................................................................
10.10 LDAP Authentication.......................................................................................
10.11 What is Security Assertion Markup Language (SAML)?................................
10.12 What is a SAML Provider?..............................................................................
10.13 Spring SAML2.0 Web SSO Authentication....................................................
10.14 Setting Up an SSO Provider.............................................................................
10.15 Adding SAML Dependencies to a Project.......................................................
10.16 SAML vs. OAuth2...........................................................................................
10.17 OAuth2 Overview............................................................................................
10.18 OAuth – Facebook Sample Flow.....................................................................
10.19 OAuth Versions................................................................................................
10.20 OAuth2 Components........................................................................................
10.21 OAuth2 – End Points.......................................................................................
10.22 OAuth2 – Tokens.............................................................................................
10.23 OAuth – Grants................................................................................................
10.24 Authenticating Against an OAuth2 API..........................................................
10.25 OAuth2 using Spring Boot – Dependencies....................................................
10.26 OAuth2 using Spring Boot – application.yml..................................................
10.27 OAuth2 using Spring Boot – Main Class.........................................................
10.28 OAuth2 using Spring Boot – Single Page Application Client.........................
10.29 JSON Web Tokens...........................................................................................
10.30 JSON Web Token Architecture.......................................................................
10.31 How JWT Works..............................................................................................
10.32 JWT Header.....................................................................................................
10.33 JWT Payload....................................................................................................
10.34 JWT Example Payload.....................................................................................
10.35 JWT Example Signature..................................................................................
10.36 How JWT Tokens are Used.............................................................................
10.37 Adding JWT to HTTP Header.........................................................................
10.38 How The Server Makes Use of JWT Tokens...................................................
10.39 What are “Scopes”?..........................................................................................
10.40 JWT with Spring Boot – Dependencies...........................................................
10.41 JWT with Spring Boot – Main Class...............................................................
10.42 Summary..........................................................................................................
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI
11.1 Foundation of Agile AppDev.............................................................................
11.2 XP Flow.............................................................................................................
11.3 Extreme Programming.......................................................................................
11.4 Agile Development............................................................................................
11.5 What is Continuous Integration.........................................................................
11.6 What is Continuous Integration (cont'd)............................................................
11.7 What is Continuous Integration (cont'd)............................................................
11.8 What is Continuous Integration (cont'd)............................................................
11.9 Typical Setup for Continuous Integration..........................................................
11.10 Setup Notes for Continuous Integration...........................................................
11.11 CI with Artifact Management..........................................................................
11.12 What is Continuous Delivery?.........................................................................
11.13 Why Continuous Delivery?..............................................................................
11.14 DevOps and Continuous Delivery...................................................................
11.15 Continuous Delivery Challenges......................................................................
11.16 Continuous Delivery vs Continuous Deployment............................................
11.17 DevOps and Continuous Code Quality............................................................
11.18 What Does Continuous Delivery Mean?..........................................................
11.19 Deployment Pipelines......................................................................................
11.20 Your Organization is Doing CD if
11.21 Pipelining for CD.............................................................................................
11.22 Continuous Integration.....................................................................................
11.23 CI Pipeline........................................................................................................
11.24 CD & CI Methodologies..................................................................................
11.25 Key Tool Categories for CI/CD.......................................................................
11.26 Enterprise DevOps Playbook...........................................................................
11.27 Enterprise DevOps Playbook (Cont'd).............................................................
11.28 Enterprise DevOps Playbook (Cont'd).............................................................
11.29 Jenkins Continuous Integration........................................................................
11.30 Jenkins Features...............................................................................................
11.31 Running Jenkins...............................................................................................
11.32 Hotfixes............................................................................................................
11.33 Summary..........................................................................................................
Chapter 12 - Job Types in Jenkins...................................................................................
12.1 Introduction........................................................................................................
12.2 Different types of Jenkins Items........................................................................
12.3 Different types of Jenkins Items (cont'd)...........................................................
12.4 Different types of Jenkins Items (cont'd)...........................................................
12.5 Configuring Source Code Management(SCM)..................................................
12.6 Working with Subversion..................................................................................
12.7 Working with Subversion (cont'd).....................................................................
12.8 Working with Git...............................................................................................
12.9 Storing Credentials.............................................................................................
12.10 Service Accounts..............................................................................................
12.11 Storing Credentials (cont'd)..............................................................................
12.12 Build Triggers..................................................................................................
12.13 Schedule Build Jobs.........................................................................................
12.14 Polling the SCM...............................................................................................
12.15 Polling vs Triggers...........................................................................................
12.16 Maven Build Steps...........................................................................................
12.17 Summary..........................................................................................................
Chapter 13 - Continuous Delivery and the Jenkins Pipeline...........................................
13.1 Continuous Delivery..........................................................................................
13.2 Continuous Delivery (cont'd).............................................................................
13.3 DevOps and Continuous Delivery.....................................................................
13.4 Continuous Delivery Challenges........................................................................
13.5 Continuous Delivery with Jenkins.....................................................................
13.6 The Pipeline Plugin............................................................................................
13.7 The Pipeline Plugin (cont'd)...............................................................................
13.8 Defining a Pipeline.............................................................................................
13.9 A Pipeline Example............................................................................................
13.10 Pipeline Example (cont'd)................................................................................
13.11 Parallel Execution............................................................................................
13.12 Creating a Pipeline...........................................................................................
13.13 Invoking the Pipeline.......................................................................................
13.14 Interacting with the Pipeline............................................................................
13.15 Pipeline vs Traditional Jobs.............................................................................
13.16 Conclusion........................................................................................................
Chapter 1 - DevOps Fundamentals....................................................................................
1.1 Why DevOps?........................................................................................................
 Rapidly deliver reliable, scalable micro and macro services that are critical
for the business time-to-market and value
 Bring the Development and Operations teams together
 Technical benefits:
◊ Continuous delivery
◊ Reduction in component complexity
◊ Agility in problem resolution
 Business benefits:
◊ Agility in delivery of business benefit
◊ Increased stability
◊ More focus on competitive advantage, rather than simply “keeping the
lights on”
1.2 What is DevOps?....................................................................................................
 Combination of people, process, tools, vendors, partners
 All the – ity words, agility, reliability, scalability,
sustainability, reproducibility, ...
 Focus on
◊ Knowledge sharing
◊ Automation
◊ Collaborative culture
◊ Time to market & value
Chapter 1 - DevOps Fundamentals

1.3 What is DevOps?....................................................................................................
 DevOps is an organizational culture for application development and
maintenance success. It encompasses technology and process
 DevOps encourages transparency and candid communication between
software developers and IT operations and administration to increase the
agility with which applications are delivered
 By automating, monitoring, and measuring the production of code through
develop, release, test, and maintenance the process becomes more
sustainable, scalable, and repeatable
 Optimally all manual tasks are eliminated, reducing the potential for
human error and making delivery and roll-back less error prone
1.4 What is DevOps?....................................................................................................
 Creating common goals for development and operations of getting apps
deployed as quickly, safely, and efficiently as possible
 Developers building in switches, dials, and flags that enable operations to
disable features or dial them down, when traffic spikes or problems occur
 Operations teams working closely with developers to facilitate agile and
on-going deployments – no over the fence handoffs
 Teams building reliable and repeatable processes to support business, as
well as, understanding their purpose in the organizational value chain
Chapter 1 - DevOps Fundamentals

1.5 Collaborative, Matrixed and Cross-Functional Teams..........................................
 Start by understanding the interactions
between different teams in the organization
 Are builds “tossed over the wall” from
Development to Testing, and then from Testing
to Operations?
 What is the visibility between the various
teams?
 Do teams “wash hands” after a hand-off or stay
involved?
 How agile and focused are communication for
releases, builds, and bugs?
1.6 Key Components of Successful DevOps Teams....................................................
 “A3 & C”:
◊ Shared A ccountability
◊ A utomation of almost anything
◊ A nalytics
◊ Culture of C ollaboration
 Other keys areas include leadership, consistent messaging, and
standards
Key Components of Successful DevOps Teams

These components require a solid workforce strategy to be able to create the knowledge-base and
processes to support collaborative, automated, and measured improvements toward technology-enabled
business.

Chapter 1 - DevOps Fundamentals

1.7 DevOps-ification....................................................................................................
 When deciding on application of DevOps, ask these four questions
◊ What is the optimal or required business outcome?
◊ How are current processes meeting requirements?
◊ Why is this project or process a priority for change?
◊ Who would benefit from a change in daily work?
DevOps-ification

The key is to choose priorities that meet both tactical and strategic goals. With any new initiative
selection criteria should have several goals for long term strategy and several for short term wins.
Don’t try to boil the ocean, but rather expect that like anything that encompasses the organization that
the most likely window for end-to-end DevOps-ification is 3-5 years.

1.8 DevOps Vocabulary...............................................................................................
 Silo – The antithesis of DevOps; consider this the “dark side”
 Release – What does this term mean to different teams and how do you
come to one definition across the organization
 Transparency – Requires cross team communication, consider this the
“light side”
 Automation – Any task that could be done more than once should be
automated
 Measurement – Anything worth doing needs to be measured, monitored,
and analyzed for success or failure
 Notification – Tell people when it goes right, tell more people if it goes
wrong
 Leadership – DevOps like any organizational initiative needs buy0in from
the top and grass-roots support
 Microservices – An architectural style characterized by product focus,
automated release, intelligent endpoints, and distributed governance and
Chapter 1 - DevOps Fundamentals

control
DevOps Vocabulary

In many organizations, communications have to go up an org chart before they can cross into other
silos in the organization. If a defect is identified, is the communication a narrow band to resolve the
issue, with wider bands to communicate the impact, resolution, and any retrospect information?

1.9 DevOps Goals........................................................................................................
 Shift Left - DevOps goes hand-in-hand with Agile software development
methodologies. This places emphasis on rapid identification of defects.
 Competitive Advantage - Faster
 Technology Enabled Business - Time to market and value
 Agility - Any developer or server environment should be able to be
reloaded in a short amount of time, e.g. 4 hours from request
 Happy people - Effective DevOps implementations incur less daily stress
and remove constant fire drills. This converts to better customer
experience, both internally and externally
DevOps Goals

In many organizations, communications have to go up an org chart before they can cross into other
silos in the organization. If a defect is identified, is the communication a narrow band to resolve the
issue, with wider bands to communicate the impact, resolution, and any retrospect information?

Chapter 1 - DevOps Fundamentals

1.10 Not DevOps - Crush Buzzwords..........................................................................
 Automating infrastructure
 Building out CI/CD pipelines
 Writing scripts
 Create new silo called DevOps
 Doing anything on cloud
Not DevOps - Crush Buzzwords

DevOps comes with many misconceptions from the various vendors and technologies who claim that
“use this product” or “use this technology” and you are a DevOps organization. DevOps requires often
significant changes in the workforce strategy in terms of education and organization, as well as, the
processes that involve technology and business teams

1.11 Driving Business Outcomes with DevOps...........................................................
 Business teams are highly motivated by time to market (agility)
 Less churn means the right frequency for releases and less wasted time
 Business teams see components early in development to reduce rework
 Efficiency in Digital Data Supply Chain
Driving Business Outcomes with DevOps

DevOps done right should increase the revenue or net margin in an organization, or improve customer
satisfaction/experience.

Chapter 1 - DevOps Fundamentals

1.12 Technology-Enabled Business.............................................................................
 Data as an asset through the entire organizational digital data supply
chain and enabled by analytics
 Quality improvement in product or services due to more rapid iterations,
increased accuracy of models, and faster feedback loops
 Competitive advantage through time to market and value
 Improved customer satisfaction by enabling the ability to customize,
improved quality, and agile delivery of new products the customers desire
Technology-Enabled Business

DevOps done right should increase the revenue or net margin in an organization, or improve customer
satisfaction/experience.

Chapter 1 - DevOps Fundamentals

1.13 DevOps Key Enabler for Digital Transformation................................................
1.14 Core Values and Mission.....................................................................................
 How does the team align to the core values and mission of the
organization?
 Do all team members understand how their roles and responsibilities
support the organization?
Chapter 1 - DevOps Fundamentals

Core Values and Mission

Ensure that people know what their role in the DevOps digital transformation is, put in your
organizations language of change. This includes group huddles outlining the change, as well as,
individual conversations from manager to team member to ensure they understand their roles and
responsibilities, and to allow for feedback loops.

1.15 Core Values - Culture...........................................................................................
 Culture is the “way of life” of the organization
 Culture is pervasive and enduring
 DevOps culture is expressed by
 Understanding motivations of other groups
 Trust, elimination of blame
 Embracing failure as necessary for improvement
 Focus on process and bottlenecks
 Elimination of unplanned work
 Emergence of dedicated cross-functional teams
 Candor and transparency
Chapter 1 - DevOps Fundamentals

1.16 Core Values - Automation...................................................................................
 Automation
◊ Allows focus on value-adding activities
◊ Reduces errors
◊ Makes processes explicit (and versionable)
 Automation is not a goal – it is a means to an end
◊ Wrong automation is worse than no automation
◊ Automation is a tool to improve process
performance and consistency
 Effective automation requires understanding of end-
to-end processes
1.17 Core Values - Measurement.................................................................................
 “If you can’t measure it, you can’t improve it.” –
Peter Drucker
 Measure all things – within reason
 Define key performance indicators (KPIs)
◊ KPIs should never be viewed in isolation -
always interpret in the context of other KPIs
◊ KPIs for DevOps should measure performance
across departments or functions
◊ Define the business question first before defining
the KPI
Chapter 1 - DevOps Fundamentals

1.18 Core Values - Sharing..........................................................................................
 Sharing closes feedback loop across functions,
teams, departments
 Sharing enables continuous learning and
improvement
 Consider knowledge-sharing culture of
organization:
◊ How knowledge is captured, disseminated and
propagated
◊ Is knowledge shared collaboratively or is
maintained by individuals or within teams
◊ Are repositories of knowledge formal and
maintained, or ad-hoc and prone to decay over
time
1.19 Communication....................................................................................................
 Challenges to communication
◊ Organizational silos, physical location
◊ Differences in concerns and priorities
◊ Formal mechanisms like change requests, stage gates, and service
tickets
 Improve communication through
◊ More frequent interactions
◊ Appropriate tools (meetings, huddles, email, Skype, Snapchat, KIK, IM,
Slack, ...)
◊ Communication is less about formal process, and more about
Chapter 1 - DevOps Fundamentals

collaboration
1.20 Collaboration........................................................................................................
 Development-to-operations lifecycle is a single end-to-end process
 End-to-end process may be assembled from more focused processes
 Agile for software development
 ITIL for deployment and operations
 Support collaboration with unified tooling
 Jenkins or GoCD for continuous integration and delivery
 Infrastructure as code with Puppet, Chef, or similar
 Single knowledge repository across entire process
 Support collaboration through team structure
 One team unified by team building, candor, and transparency
 Or several closely connected teams with a common objective
Chapter 1 - DevOps Fundamentals

1.21 Value Stream Mapping........................................................................................
 Method for analysis of current practices, design of
new practices
 “Practices” are an orchestrated sequence of
activities that meet needs of customers
 Based on process view of organizations, treating
the organization as a system of interlinked
processes
 Each process has inputs, transformations, and
outputs
 Value Stream Mapping provides framework for
formally designing future state of software delivery
process
1.22 Behavioral Patterns for Success...........................................................................
 7 Habits of Highly Effective DevOps Experts
 Think culture
Culture → People → Process → Tools
◊ Automation – for anything that is difficult or repetitive
◊ Shift left – quality through shared understanding
◊ Transparency – communication of purpose and intent
◊ Standardization – drive savings, sharing, efficiency
◊ Compliance – design and include those teams upfront
◊ Knowledge sharing – runbooks, releases, education
◊ Collaboration
Chapter 1 - DevOps Fundamentals

1.23 DevOps Org Structures........................................................................................
 DevOps team AKA Development → DevOps ← Operations
◊ Do not create a DevOps Silo, but rather a meet in the middle
organization through either a COE or an entire focused team with staff
from both Development, Operations, and other relevant groups
◊ Development merged with Operations
◊ Development overlapped with Operations
 Organizational structure will determine team communications and goals.
Breaking down organizational silos is key to DevOps implementation
 Proof of Concept or Pilot team should be used with a medium risk/priority
project for a tactical win
 Do not start with mission critical application for first round, unless it is the
only application you have, and then take a small to medium bite
Chapter 1 - DevOps Fundamentals

1.24 DevOps Team - Separate.....................................................................................
1.25 DevOps Merged Organization.............................................................................
 Fully embedded DevOps
◊ Single-product offering focus
◊ “We build it, we run it” culture
◊ Each product has it's own DevOps team
Chapter 1 - DevOps Fundamentals

1.26 DevOps Overlapped Organization.......................................................................
 For mature orgs with deep focus on operational excellence
 Development meets specified operational criteria
 Development focused on new features, not production ops
 SRE team engineers operating environment, operational criteria
1.27 Organizational Structure Leadership....................................................................
 Key considerations
◊ Single Executive or Single Group Leadership
◊ Business case funding for implementation
◊ Priorities – Top n projects, applications, products
◊ Steering committee sets priority
◊ Clear communication on business value chain
◊ Inclusion of key stakeholders to get every brain in the game
Chapter 1 - DevOps Fundamentals

1.28 Summary..............................................................................................................
 DevOps is an approach to delivering software value
 It sees the final product not as "software" but "software installed in
production"
 View the entire delivery chain as a process, that can be studied and
optimized
 Cultural Values and Technology combine to deliver value
Chapter 2 - Introduction to Git Flow.................................................................................
Objectives
Key objectives of this chapter
 Understanding Git Flow
 Understanding Features
 Understanding Releases
 Understanding Hotfixes
 Git Flow and Continuous Integration
 Git Flow Alternatives
2.1 Why Use an SCM Workflow?...............................................................................
 Using the right SCM workflow can help in the various scenarios, such as:
◊ When you are trying to manage the integrity of a code base that
involves numerous developers with conflicting release schedules.
◊ When you get tired of wondering what best practices you should follow
◊ When you don’t have time to dig through the commit diffs of 500
commits to find out why a push from a specific person causes major
unintended changes to your project.
◊ When a feature that’s not ready for release sneaks its way into
production.
◊ When you don’t want to explain to stakeholders that you can’t release
feature X because feature Y has not yet cleared QA.
2.2 Why Use an SCM Workflow? (Cond.)..................................................................
 Using the right SCM workflow can provide these benefits:
◊ Visibility - If you need a way to understand who is working on which
feature and how to pick up where they left off if they get pulled away to
work on another project, visibility is very important.
◊ Flexibility - If business expectations require you to be able to quickly
Chapter 2 - Introduction to Git Flow

switch between working on “urgent, must go live now” tasks and “show
me what it would look like if...” tasks then your workflow should allow
you to isolate features allowing them to go to production on different
schedules.
◊ Collaboration - Teams should strive to reduce maintenance overhead
by standardizing the way you write and contribute code. You need a
way to collaborate on code that helps enforce code standards and best
practices while pushing each contributor to continually improve.
◊ Control - Determining who should and should not have write access to
your repository is a huge factor in deciding the right workflow.
2.3 What is Git Flow....................................................................................................
 Git Flow is a branching model for Git.
 Created by Vincent Driessen and widely adopted by many organizations
 A set of git extensions to provide high-level repository operations.
 The model is scalable.
 Well suited to collaboration due to the isolation of code across branches
 Maps to the Continuous Integration (CI) and Continuous Delivery (CD)
models of code being consistently buildable and deployable in the release
and main branches
Chapter 2 - Introduction to Git Flow

2.4 The Main Branch....................................................................................................
 The purpose of the main branch in the git flow workflow is to container
production ready code that can be released.
 The main branch:
◊ Is created at the start of a project
◊ Is tagged at various commits to signify specific versions or releases
 All other branches are eventually merged into the main branch after being
sufficiently vetted and tested
 The main branch was previously referred to as the 'master' branch. The
prior terminology has been phased out and wherever possible should be
replace with 'main'.
2.5 Benefits..................................................................................................................
 Parallel development
◊ Isolates new development work from finished work
◊ Code is merged back into main body of code when developers are
happy that code is ready for release.
 Collaboration
 Release Staging Area
◊ New development work is merged back into the develop branch
◊ 'Develop' branch is a staging area for all completed features that
haven't yet been released.
 Support for hotfixes
◊ Hotfix branches – branches made from a tagged release which can be
used to make an emergency change.
Chapter 2 - Introduction to Git Flow

2.6 How Git Flow works?............................................................................................
 New development are built in feature branches.
Chapter 2 - Introduction to Git Flow

2.7 How Git Flow works? (Contd.)..............................................................................
 Feature branches are branched off of the develop branch.
 Finished features are merged back into the develop branch.
Chapter 2 - Introduction to Git Flow

2.8 What is Git Flow? (Contd.)....................................................................................
 When features are completed, a release branch is created off of develop
branch.
Chapter 2 - Introduction to Git Flow

2.9 How Git Flow works? (Contd.)..............................................................................
 The code in the release branch is deployed, tested, fixed, redeployed, and
retested.
 Release branch is merged into main and into develop branch.
Chapter 2 - Introduction to Git Flow

2.10 How Git Flow works? (Contd.)............................................................................
 The main branch contains released code only.
 The only commits to main are merges from release branches and hotfix
branches.
 Hotfix branches are branched directly from a tagged release in the main
branch.
 Hotfixes, when finished, are merged back into both main and develop to
ensure the hotfixes aren't accidentally lost when next release occurs.
Chapter 2 - Introduction to Git Flow

2.11 Git Flow Extension..............................................................................................
 All the above can be implemented using Git's inbuilt branching and
merging
 To simplify a little, there's an “extension” to Git called “Git Flow”
 The extension is shipped by default with “Git for Windows”
 Available through package managers
◊ e.g. 'sudo apt-get install git-flow'
2.12 Initializing Git Flow.............................................................................................
 Initialized inside an existing git repository
git flow init

 Recommended to use the default values for branches
2.13 Features................................................................................................................
 New development is organized in the form features
 Typically exist in developers repository only
 Start a new feature
git flow feature start FEATURE_NAME
 Finish up a feature
◊ Merges feature into develop branch
◊ Removes the feature branch (unless you use -k switch to keep it)
◊ Switches back to develop branch

git flow feature finish FEATURE_NAME
 Published feature
◊ Useful for pushing a feature to the remote repository so it can be used
by other users

git flow feature publish FEATURE_NAME
git flow feature pull origin FEATURE_NAME

Chapter 2 - Introduction to Git Flow

2.14 Release.................................................................................................................
 Finalized features are merged into a release branch
 Allow for minor bug fixes
 Start a release
◊ Release branch is created from the develop branch
git flow release start RELEASE [BASE]
e.g.
git flow release start REL_1.0 develop
 Finish up a release
◊ Merges the release branch back into 'main'
◊ Tags the release with its name
◊ Back-merges the release into 'develop' branched
◊ Removes the release branch unless you use -k switch to keep it

git flow release finish RELEASE -m "tag"

 Publish a release
◊ For collaboration, a release can be published to a remote repository
git flow release publish RELEASE

2.15 Hotfixes................................................................................................................
 Changes required to fix an undesired state of a live production version
 Hotfixes can be branched off from the corresponding tag on the main
branch that marks the production version
 Create a hotfix branch
git flow hotfix start VERSION [BASENAME]
 e.g.

git flow hotfix start 'REL_1.0.1' develop
 Finish a hotfix
 Finishing a hotfix gets merged back into develop and main branches.
 main merge is tagged with the hotfix version

Chapter 2 - Introduction to Git Flow

git flow hotfix finish VERSION
 e.g.

git flow hotfix finish REL_1.0.1

2.16 Git Flow and Continuous Integration...................................................................
 Each commit that gets pushed to a repository should get picked up
automatically by some kind of Continuous Integration build system, such
as Jenkins
 The CI system is responsible for trying to integrate proposed code
changes with a destination branch, for example when creating a pull-
request for a feature branch, the CI system will:
◊ try to merge the feature branch into the destination branch (develop in
this case)
◊ build the merged result while enforcing coding style
◊ run unit-tests while capturing code-coverage
◊ run integration-tests
◊ create a package
◊ deploy the package (if continuous deployment is being used for the
given branch)
 For lengthy integration-tests, you can decide not to run the tests for pull-
request and only run them for release and hotfix branches.
2.17 Git Flow – Summary............................................................................................
 It is based on two main branches with an infinite lifetime:
◊ main — this branch contains production code. All development code is
merged into main
◊ develop — this branch contains pre-production code. When the features
are finished then they are merged into develop.
 During the development cycle, a variety of supporting branches are used:
◊ feature-* — feature branches are used to develop new features for the
Chapter 2 - Introduction to Git Flow

upcoming releases. May branch off from develop and must merge into
develop.
◊ hotfix-* — hotfix branches are necessary to act immediately upon an
undesired status of main. May branch off from main and must merge
into main and develop.
◊ release-* — release branch is created for each production release. May
branch off from develop and must merge into main and develop.
2.18 Git Flow – Pros and Cons....................................................................................
 Pros
◊ Ensures a clean state of branches at any given moment in the life cycle
of project
◊ The branches naming follows a systematic pattern making it easier to
comprehend
◊ It has extensions and support on most used git tools
◊ It is recommended when there needs to be multiple versions in the
production.
 Cons
◊ The main/develop split is considered redundant and makes the
Continuous Delivery and the Continuous Integration harder
◊ It isn’t recommended when it need to maintain single version in
production
2.19 Git Flow – When it Works Best?.........................................................................
 You run an open-source project: Since everyone can contribute, you
want to have very strict access to all the changes.
 You have a lot of junior developers: You want to have a way to check
their work closely. People who accept pull requests have strict control over
recurring changes so they can prevent deteriorating code quality.
 You have an established product and large enterprises: In such
Chapter 2 - Introduction to Git Flow

cases, the focus is usually on application performance and load
capabilities. That kind of optimization requires very precise changes.
Usually, development time is not a constraint, since they don’t want to
break their multi-million dollar investment.
2.20 Git Flow – When it Doesn’t Work?.....................................................................
 You are just starting up: Chances are you want to create a minimal
viable product quickly. Doing pull requests creates a huge bottleneck that
slows the whole team down dramatically.
 When you need to iterate quickly: Multiple branches and pull requests
reduce development speed dramatically and are not advised in such
cases.
 When you work mostly with senior developers: If your team consists
mainly of senior developers who have worked with one another for a
longer period of time, then you don’t really need the pull request
micromanagement.
2.21 Git Flow Alternatives...........................................................................................
 There are several alternatives to Git Flow. The most popular ones are:
◊ Trunk-based Development
◊ GitHub Flow
◊ GitLab Flow
2.22 Trunk-based Development...................................................................................
 Trunk-Based Development rejects any feature branches, hotfix branches,
parallel release branches. There is only one branch available to the
developers—the Trunk.
 All developers work on the trunk where developers directly commit
 A release manager can create release branches and no one can commit
to those
Chapter 2 - Introduction to Git Flow

 Developers commit small changes as often as they can,
 Commits should be reviewed and tested and must not destroy the
mainline.
2.23 Trunk-based Development (Contd.).....................................................................
https://paulhammant.com/2013/04/05/what-is-trunk-based-development/
 Developers perform commits, as many as they can, on the "trunk" branch.
 Every commit is a small part of the code, e.g. one function or method with
unit tests (green squares).
 At some point, when the trunk branch contains every feature that we want,
one person creates a new release branch from the trunk. Such a person is
called the release manager or release engineer.
2.24 Trunk-based Development – When it Works?.....................................................
 You are just starting up: If you are working on your minimum viable
product, then this style is perfect for you. It offers maximum development
speed with minimum formality since there are no pull requests.
 You need to iterate quickly: If are still in the exploration phase and you
need to be able to change your product as fast as possible, this workflow
won’t slow you down.
Chapter 2 - Introduction to Git Flow

 You work mostly with senior developers: If your team consists mainly
of senior developers, then you should trust them and let them do their job.
2.25 Trunk-based Development – When it Doesn’t Work?.........................................
 You run an open-source project: If you are running an open-source
project and need very strict control over changes, then Git flow is the
better option.
 You have a lot of junior developers: If you hire mostly junior developers,
then it’s a better idea to tightly control what they are doing.
 You are a large enterprise, have established product, or manage large
teams
2.26 GitHub Flow.........................................................................................................
 The GitHub Flow is a lightweight workflow created by GitHub in 2011
 It respects the following 6 principles:
◊ Anything in the main branch is deployable
◊ To work on something new, create a branch off from main and given a
name
◊ Commit to that branch locally and regularly push your work to the same
named branch on the server
◊ When you need feedback or help, or you think the branch is ready for
merging, open a pull request
◊ After someone else has reviewed and signed off on the feature, you
can merge it into main
◊ Once it is merged and pushed to main, you can and should deploy
immediately
Chapter 2 - Introduction to Git Flow

2.27 GitHub Flow – Pros and Cons.............................................................................
 Pros
◊ A simpler alternative to Git Flow
◊ It is ideal when it needs to maintain a single version in production
 Cons
◊ The production code can become unstable most easily
◊ Not adequate when there’s a need for the release plans
◊ It isn’t recommended when multiple versions in production are needed
2.28 GitLab Flow.........................................................................................................
 The GitLab Flow was created by GitLab in 2014.
 It combines feature-driven development and feature branches with issue
tracking.
 The major difference between GitLab Flow and GitHub Flow is the
environment branches in GitLab Flow (e.g. staging and production)
 The GitLab Flow has the following principles:
◊ Use feature branches, no direct commits on main
◊ Perform code reviews before merges into main, not afterward.
◊ Deployments are automatic, based on branches or tags.
◊ Tags are set by the user, not by CI.
◊ Releases are based on tags.
◊ Pushed commits are never rebased.
◊ Everyone starts from main and targets main.
◊ Fix bugs in main first and release branches afterward.
Chapter 2 - Introduction to Git Flow

2.29 GitLab Flow – Environment Branches................................................................
 Suppose you have a staging environment, a pre-production environment,
and a production environment. In this case, deploy the main branch to
staging. To deploy to pre-production, create a merge request from the
main branch to the pre-production branch. Go live by merging the pre-
production branch into the production branch.
 This workflow, where commits only flow downstream, ensures that
everything is tested in all environments.
 If you need to commit with a hotfix, it is common to develop it on a feature
branch and merge it into main with a merge request. In this case, do not
delete the feature branch yet. If main passes automatic testing, you then
merge the feature branch into the other branches.
Chapter 2 - Introduction to Git Flow

2.30 GitLab Flow – Release Branches.........................................................................
 You only need to work with release branches if you need to release
software to the outside world.
 Each branch contains a minor version, for example, 2-3-stable, 2-4-stable,
etc.
 Create stable branches using main as a starting point, and branch as late
as possible.
 By doing this, you minimize the length of time during which you have to
apply bug fixes to multiple branches.
 After announcing a release branch, only add serious bug fixes to the
branch.
2.31 GitLab Flow – Release Branches (Contd.)..........................................................
 If possible, first merge these bug fixes into main, and then cherry-pick
them into the release branch.
 If you start by merging into the release branch, you might forget to cherry-
pick them into main, and then you’d encounter the same bug in
Chapter 2 - Introduction to Git Flow

subsequent releases.
 Merging into main and then cherry-picking into release is called an
“upstream first” policy, which is also practiced by Google and Red Hat.
 Every time you include a bug fix in a release branch, increase the patch
version by setting a new tag.
 Some projects also have a stable branch that points to the same commit
as the latest released branch. In this flow, it is not common to have a
production branch (or Git flow main branch).
2.32 GitLab Flow – Pros and Cons..............................................................................
 Pros
◊ The git history is cleaner
◊ It is ideal when there will be a single version in production
 Cons
◊ It is more complex than GitHub Flow
◊ When there’s a need to maintain multiple versions in the production, it
can be as complex as Git Flow.
2.33 Summary..............................................................................................................
 Git Flow is a branching model for git
 It is a set of extensions for git.
 The branching model supports features, releases, and hotfixes.
 GitHub Flow and GitLab Flow are the popular alternatives to Git Flow.
Chapter 3 - Breaking Up Monoliths – Pros and Cons.......................................................
Objectives
Key objectives of this chapter
 Monolithic applications: Pros and Cons
 Architecture modernization
 Dealing with monoliths
3.1 Traditional Monolithic Applications and Their Place............................................
 Mostly, enterprise applications
◊ Use a homogeneous development stack (i.e. JEE or .NET)
◊ All tiers (front-end, business logic, data access layer) are commonly
packaged into and deployed as one artifact (e.g. an EAR with a number
of WAR archives, etc.)
◊ Favor a stateful app design
◊ Typically backed by a large (relational) database
 Monolithic application design is great for
◊ High-performance/critical real-time systems
◊ Systems built around intricate transaction semantics
◊ Systems where tight coupling and/or monolithic integration is required
(due to security considerations, high cost of cross-process interactions,
etc.)
3.2 Disadvantages of Monoliths...................................................................................
 Tight coupling of system components makes it difficult to evolve,
troubleshoot, test, and maintain the application as a whole or any of its
parts
 Inherent resistance to change
 Lack of anti-corruption boundaries within and/or across layers
Chapter 3 - Breaking Up Monoliths – Pros and Cons

 Difficult to scale elastically
◊ That's a big hampering factor for going cloud-native
 Long term commitment to single technology (potentially, a vendor lock-in
situation)
3.3 Developer's Woes...................................................................................................
 Due to their potential large codebase / deployment footprint, monoliths can
pose problems to source code control management
◊ Code changes create contention points resulting in constant code
merges causing development teams' frustration and slow development
velocity
◊ Developers may also be overwhelmed by being exposed to a large
code base
◊ All these facts hamper agile development practices
3.4 Architecture Modernization...................................................................................
 An emerging trend in the enterprise application space is for organizations
to embark on a journey of Architecture Modernization which involves re-
designing existing / legacy (often monolithic) applications using
microservices-based architectural style – Microservices Architecture
◊ Unfortunately, the good ol' SOA did not have the technical depth to
contain the proliferation of monoliths
 In essence, Architecture Modernization drives the adoption of distributed
application design using microservices
◊ These initiatives are often a part of companies' cloud migration strategy
Chapter 3 - Breaking Up Monoliths – Pros and Cons

3.5 Architecture Modernization Challenges................................................................
 Arguably, the biggest challenge of transforming the monolith's design into
a new Microservices Architecture lies in factoring out and converting
native in-processes calls into inter-microservices interactions
 A straightforward conversion to some sort of RPC-based calls (e.g.
RESTful calls) may have negative impact on the overall performance of
the solution, its scalability, and resiliency
◊ Some help comes from asynchronous communication and other
patterns discussed later in the course
3.6 Microservices Architecture is Not a Silver Bullet!................................................
 Many practitioners in the field have a word of caution:
◊ “ Don’t even consider microservices unless you have a system that’s
too complex to manage as a monolith ” [https://bit.ly/2QFtmT6]
 Monoliths in many cases may be just adequate for the job
 Microservices carry their own baggage of accidental complexity and would
require significant investment in new infrastructure, changing your
application architecture, development practices, and may require an
overall cultural shift
3.7 What May Help?....................................................................................................
 Refactoring a monolith into a microservices-based application is facilitated
by the following architecture attributes of the existing monolithic
application:
◊ Layered architecture
◊ Separation of sub-system responsibilities in well-defined cross-cutting
concerns by means of orthogonal design / AOP
◊ Reducing coupling between system components through design-by-
contract, DI (IoC), etc.
 In other words, if you have all or any of the above, your Application
Chapter 3 - Breaking Up Monoliths – Pros and Cons

Modernization journey is going to be faster and easier
Notes:

When Moving from a Legacy Monolith

This transition phase offers an opportunity to carry out these activities:

 Critically examine existing code base; remove dead code
 Consider whether new patterns might better solve problems
 Develop a DevOps policy that accounts for iterative service development
 Provide for increased network communications
 Focus on security (encryption, authentication, authorization) and performance (move UI
generation logic to the client)
 Perform development methodology review
 Agile methodologies (e.g. SCRUM, Kanban, XP) are suited to iterative development
 Review testing approach (now it can be done on the per-service basis)
 Decide on service-level scalability requirements
3.8 In-Class Discussion................................................................................................
 Do you have any monoliths you have to deal with?
 Can you share some of the problems / success stories dealing with
monoliths?
 Any Architecture Modernization plans in your organization?
Chapter 3 - Breaking Up Monoliths – Pros and Cons

3.9 Summary................................................................................................................
 In this module we reviewed some of the disadvantages of monolithic
application design
 Converting to microservices is not a silver bullet that could help with your
Architecture Modernization efforts; there are a number of design
considerations that can help you with these initiatives, though:
◊ Layered architecture
◊ Separation of sub-system responsibilities in well-defined cross-cutting
concerns by means of orthogonal design / AOP
◊ Reducing coupling between system components through design-by-
contract, DI (IoC), etc.
Chapter 4 - Twelve-factor Applications............................................................................
Objectives
Key objectives of this chapter
 Twelve-factor Application Microservices
 Categorizing the Twelve Factors
4.1 Twelve-factor Applications....................................................................................
4.2 Twelve Factors, Microservices, and App Modernization......................................
 Heroku, a platform as a service (PaaS) provider, established general
principles for creating useful web apps known as the Twelve-Factor
Application
 Applying 12-factor to microservices requires modification of the original
PaaS definitions
 The goal of combining microservices, twelve-factor app and app
modernization is a general purpose reference architecture enabling
continuous delivery
4.3 The Twelve Factors................................................................................................
 I. Codebase - One codebase tracked in revision control, many deploys

 II. Dependencies - Explicitly declare and isolate dependencies

 III. Config - Store config in the environment

 IV. Backing services - Treat backing services as attached resources

 V. Build, release, run - Strictly separate build and run stages

 VI. Processes - Execute the app as one or more stateless processes

 VII. Port binding - Export services via port binding

 VIII. Concurrency - Scale out via the process model

 IX. Disposability - Maximize robustness with fast startup and graceful
shutdown

 X. Dev/prod parity - Keep development, staging, and production as similar
as possible

 XI. Logs - Treat logs as event streams

 XII. Admin processes - Run admin/management tasks as one-off
processes

4.4 Categorizing the 12 Factors...................................................................................
 Code

◊ Codebase
◊ Build, Release, Run
◊ Dev/prod parity
 Deploy

◊ Dependencies
◊ Config
◊ Processes
◊ Backing services
◊ Port Binding
 Operate

◊ Concurrency
Chapter 4 - Twelve-factor Applications

◊ Disposability
◊ Logs
◊ Admin Processes
4.5 12-Factor Microservice Codebase..........................................................................
 One codebase per service, tracked in revision control; many deploys
 The Twelve-Factor App recommends one codebase per app. In a
microservices architecture, the correct approach is one codebase per
service.
 This codebase should be in version control, either distributed, e.g. git, or
centralized, e.g. SVN.
4.6 12-Factor Microservice Dependencies...................................................................
 Explicitly declare and isolate dependencies
 As suggested in The Twelve-Factor App, regardless of what platform your
application is running on, use the dependency manager included with your
language or framework.
 Do not assume that the tool, library or application your code depends on
will be there.
 How you install an operating system or platform dependencies depends
on the platform:
 In noncontainerized environments, use a configuration management tool
(Chef, Puppet, Salt, Ansible) to install system dependencies.
 In a containerized environment, do this in the Dockerfile.
4.7 12-Factor Microservice Config..............................................................................
 Store configuration in the environment
 Anything that varies between deployments can be considered
configuration.
Chapter 4 - Twelve-factor Applications

 All configuration data should be stored in a separate place from the code,
and read in by the code at runtime, e.g. when you deploy code to an
environment, you copy the correct configuration files into the codebase at
that time.
 The Twelve-Factor App guidelines recommend storing all configuration in
the environment, rather than committing it to the source code repository.
◊ Use non-version controlled .env files for local development. Docker
supports the loading of these files at runtime.
◊ Keep all .env files in a secure storage system, such as Hashicorp Vault,
to keep the files available to the development teams, but not committed
to Git.
◊ Use an environment variable for anything that can change at runtime,
and for any secrets that should not be committed to the shared
repository.
◊ Once you have deployed your application to a delivery platform, use the
delivery platform’s mechanism for managing environment variables
4.8 12-Factor Microservice Backing Services.............................................................
 Treat backing services as attached resources
 The Twelve-Factor App guidelines define a backing service as “any
service the app consumes over the network as part of its normal
operation.”
 Anything external to a service is treated as an attached resource, including
other services. This ensures that every service is completely portable and
loosely coupled to the other resources in the system.
 Strict separation increases flexibility during development – developers only
need to run the service(s) they are modifying, not others.
 A database, cache, queueing system, etc. These should all be referenced
by a simple endpoint (URL) and credentials, if necessary.
Chapter 4 - Twelve-factor Applications

4.9 12-Factor Microservice Build, Release, Run.........................................................
 Strictly separate build and run stages
 To support strict separation of build, release, and run stages, as
recommended by The Twelve-Factor App, use a continuous
integration/continuous delivery (CI/CD) tool to automate builds.
 Docker images make it easy to separate the build and run stages. Ideally,
images are created from every commit and treated as deployment
artifacts.
4.10 12-Factor Microservice Processes........................................................................
 Execute the app in one or more stateless processes
 For microservices, the application needs to be stateless.
 Stateless services scale a service horizontally by simply adding more
instances of that service.
 Store any stateful data, or data that needs to be shared between
instances, in a backing service
4.11 12-Factor Microservice Port Binding...................................................................
 The twelve-factor app is completely self-contained and does not rely on
runtime injection of a webserver into the execution environment to create a
web-facing service.
 The web app exports HTTP as a service by binding to a port, and listening
to requests coming in on that port.
 In a local development environment, the developer visits a service URL
like http://localhost:5000/ to access the service exported by their app.
 In deployment, a routing layer handles routing requests from a public-
facing hostname to the port-bound web processes.
 This is typically implemented by using dependency declaration to add a
webserver library to the app, such as Tornado for Python, Thin for Ruby,
or Jetty for Java and other JVM-based languages.
Chapter 4 - Twelve-factor Applications

 This happens entirely in user space, that is, within the app’s code.
 The contract with the execution environment is binding to a port to serve
requests.
 Nearly any kind of server software can be run via a process binding to a
port and awaiting incoming requests. Examples include ejabberd
(speaking XMPP), and Redis (speaking the Redis protocol).
 The port-binding approach means that one app can become the backing
service for another app, by providing the URL to the backing app as a
resource handle in the config for the consuming app.
4.12 12-Factor Microservice Concurrency..................................................................
 Scale-out via the process model
 The Unix and Mainframe process models are predecessors to a true
microservices architecture, allowing specialization and resource sharing
for different tasks within a monolithic application.
 For microservices architecture, we horizontally scale each service
independently, to the extent supported by the underlying infrastructure.
 Docker or other containerized services, provide service concurrency.
4.13 12-Factor Microservice Disposability..................................................................
 Maximize robustness with fast startup and graceful shutdown
 Instances of a service need to be disposable so they can be started,
stopped, and redeployed quickly, and with no loss of data.
 Services deployed in Docker containers satisfy this requirement
automatically, as it’s an inherent feature of containers that they can be
stopped and started instantly.
 Storing state or session data in queues or other backing services ensures
that a request is handled seamlessly in the event of a container crash.
 Backing stores support crash-only design.
Chapter 4 - Twelve-factor Applications

4.14 12-Factor Microservice Dev/Prod Parity.............................................................
 Keep development, staging, and production as similar as possible
 Keep all of your environments – development, staging, production, and so
on – as identical as possible, to reduce the risk that bugs show up only in
some environments.
 Containers enable you to run exactly the same execution environment all
the way from local development through production.
 Differences in the underlying data can still result in runtime changes in
application behavior
4.15 12-Factor Microservice Logs...............................................................................
 Treat logs as event streams
 Use a log-management solution in a microservice for routing or storing
logs.
 Define logging strategy as part of the architecture standards, so all
services generate logs in a similar fashion
 Log strategy should be part of a larger Application Performance
Management (APM) or Digital Performance Management (DPM) solution
tied to the Everything as a Service model (XaaS)
4.16 12-Factor Microservice Admin Processes...........................................................
 Run admin and management tasks as one-off processes
 In a production environment, run administrative and maintenance tasks
separately from the app.
 Containers make this very easy, as you can spin up a container just to run
a task and then shut it down.
 Examples include doing data cleanup, running analytics for a presentation,
or turning on and off features for A/B testing.
Chapter 4 - Twelve-factor Applications

4.17 Summary..............................................................................................................
 The twelve-factor methodology can be applied to apps written in any
programming language, and which use any combination of backing
services (database, queue, memory cache, etc).
 The twelve-factor methodology is highly useful when creating
microservices architecture based applications.
Chapter 5 - Microservice Development.............................................................................
Objectives
Key objectives of this chapter
 Principles of Microservices Architecture Design
 Domain-Driven Design
 Designing for Failure
 Managing Distributed Services with Docker & Kubernetes
(OpenShift)
 Microservices and their relationship to the front-end
 Single Page Applications (SPA)
 Example of Microservices Architecture
5.1 What are Microservices?........................................................................................
 Componentized services which work well together.
 Independent processes for each microservice
 Communication through APIs, rather than using databases directly
 Architecture patterns tied to observable, distributed, secure, scalable, and
agile componentized development
 A form of SOA. Typical SOA-based applications are considered monoliths
and don't lend themselves well to the world of containerized applications
5.2 Microservices vs Classic SOA...............................................................................
SOA Microservices
XML JSON

Monolithic Component

Heavy Lightweight

Chapter 5 - Microservice Development

SOA Microservices
HTTP/SOAP HTTP/REST
5.3 Principles of Microservices Architecture Design..................................................
 Modeled around business domain
◊ Domain-driven design that can help you find stable, reusable
boundaries
 Culture of automation
◊ Moving parts means Automation is key
 Hide implementation details
◊ One of the pitfalls that distributed systems can often fall into is tightly
coupling their services together, robbing them of their autonomy.
Working out how to hide internal implementation details is one step on
the way to avoiding this problem.
 Decentralize all the things
◊ To achieve many of the benefits of these architectures, autonomy is
key. And to achieve this you often need to push power out of the
center, but organizationally and architecturally.
 Deploy independently
◊ The most important characteristics your microservices need.
 Consumer first
◊ Microservices need to work together and to make that work we need to
make them easy to consume
 Isolate failure
◊ Embracing a microservice architecture doesn’t automatically make your
systems more stable, in fact, the opposite can be the case.
Understanding how to isolate a failure in your system is key to ensure
that your system doesn’t become a fragile edifice.
 Highly observable
Chapter 5 - Microservice Development

◊ With many moving parts, understanding what is happening in your
system can be much more challenging.
5.4 Domain-Driven Design..........................................................................................
 Initially introduced and made popular by programmer Eric Evans in his
2004 book, Domain-Driven Design: Tackling Complexity in the Heart of
Software
 The domain-driven design applies to the development of software.
 It aims to ease the creation of complex applications by connecting the
related pieces of the software into an ever-evolving model.
 The domain-driven design focuses on three core principles:
◊ Focus on the core domain and domain logic.
◊ Base complex designs on models of the domain.
◊ Constantly collaborate with domain experts, in order to improve the
application model and resolve any emerging domain-related issues.
5.5 Domain-Driven Design - Benefits.........................................................................
 Code reusability - it is achieved by creating APIs in the application code
using protocols, such as REST.
 Evolution - When it comes to refactoring, or modifying your software
according to new requirements, the domain-centric approach works better
than the data-centric one.
◊ Teams adhering to the domain-centric standpoint tend to work on the
application code and the database together
 Complexity growth - DDD brings additional maintenance overhead at
the beginning but pays off greatly over time.
◊ At some point, the domain-centric method overtakes the data-centric
approach in terms of complexity
◊ It becomes easier to maintain and evolve a system adhering to its
principles.
Chapter 5 - Microservice Development

◊ DDD is worth the investment because the problem domain itself is more
important than the data it produces.
◊ The investments we make in the modeling of that domain have better
ROI.
5.6 Microservices and Domain-Driven Design............................................................
 Microservices are built around business capabilities
 Each component runs as a separate application, clustered to as many
nodes as required
5.7 Designing for failure..............................................................................................
 Microservices architecture based components are designed for failure.
 Any service can fail, anytime
 The client application has to respond as gracefully as possible
 It's important to be able to detect the failures quickly and, if possible,
automatically restore service
 Microservices applications put a lot of emphasis on real-time monitoring
 Netflix's Chaos Monkey induces failures of services during the working day
to test the application's resilience and monitoring
Chapter 5 - Microservice Development

5.8 Microservices Architecture – Pros.........................................................................
 Multiple developers and teams can deliver relatively independently of each
other
 Can be written in different programming languages
 Can be managed by different teams
 Can use different data storage technologies AKA backing services
 Independently deployable by fully automated deployment machinery
 Typically maps to smaller Agile team structure and notions of self-
organizing
5.9 Microservices Architecture – Cons........................................................................
 Distributed transactions require orchestration services
 Difficult testing – interactions between the services. May require mock
testing, if service doesn't exist
 Robust error handling and recovery is required
 Sophisticated real-time monitoring required
5.10 Docker and Microservices....................................................................................
 Docker containers drives the adoption of microservices and vice versa
 Docker puts significant emphasis on the "Unix philosophy" of shipping
containers, i.e. "do one thing, and do it well".
 Docker documentation itself says:
◊ Run only one process per container. In almost all cases, you should
only run a single process in a single container. Decoupling applications
into multiple containers makes it much easier to scale horizontally and
reuse containers
 Such principles at Docker's core philosophy makes it much closer to the
microservice architecture than a conventional, large monolithic
architecture.
Chapter 5 - Microservice Development

 When aiming for "doing one thing" it doesn't make sense to containerize
the entire, huge, enterprise application as a single Docker container.
 You would want to first modularize the application into loosely coupled
components that communicate via standard protocols, which in essence,
is what the microservices architecture delivers.
 Docker containers and microservices architecture are two ends of the road
that leads to the same ultimate goal of continuous delivery
5.11 Microservice Deployment with Docker – Workflow...........................................
 A typical workflow for microservice deployment with Docker would involve
following
◊ The code is checked into the source code repository. If this is the
project's first check-in, it is done along with Dockerfile for the project
◊ The preceding check-in triggers the build engine, such as
Maven/MSBuild, to build the service from the source code and run
unit/integration tests
◊ If tests are successful, the Docker image is created and pushed to a
Docker registry.
◊ If QA tests pass as well, the container is promoted to deploy and start
in production.
5.12 Writing Dockerfile...............................................................................................
FROM openjdk:8
RUN mkdir -p /opt/my/service
ADD target/myservice-0.0.1-SNAPSHOT.jar /opt/my/service/
EXPOSE 8080
CMD ["java", "-jar", "/opt/my/service/myservice-0.0.1-
SNAPSHOT.jar"]

 The above Dockerfile does following
◊ Uses openjdk:8 image from the Docker hub
◊ Creates a directory for storing custom service files
Chapter 5 - Microservice Development

◊ Copies myservice*.jar file into the container
◊ Makes port 8080 so it can be accessed from outside the container
◊ Executes the custom service by using java command line tool.
5.13 Kubernetes............................................................................................................
 Kubernetes offers container orchestration
 Kubernetes provides a platform for automating deployment, scaling, and
operations of application containers across clusters of hosts
 Kubernetes supports a range of container tools, including Docker
 Microservices require a reliable way to find and communicate with each
other.
 Microservices in containers and clusters can make things more complex
as we now have multiple networking namespaces to bear in mind.
 Communication and discovery requires traversing of container IP space
and host networking.
 Kubernetes benefits from getting its ancestry from the clustering tools
used by Google for the past decade. Many of the lessons learned from
running and networking two billion containers per week have been distilled
into Kubernetes
5.14 What is OpenShift................................................................................................
 OpenShift is a computer software product from Red Hat
 It provides a container-based software deployment and management
solution
 In short, it's a container orchestration software
 It is a supported distribution of Kubernetes using Docker containers and
DevOps tools
Chapter 5 - Microservice Development

5.15 OpenShift Architecture........................................................................................
5.16 Microservices and Various Applications.............................................................
 There are various types of applications, such as:
◊ Web applications
◊ Rich client applications
◊ Rich internet applications
◊ Mobile applications
◊ Services applications
 Almost all these application types can benefit from Microservices
architecture.
Chapter 5 - Microservice Development

5.17 Web Applications.................................................................................................
 This web application is typically initiated from a web browser that
communicates with a server using the HTTP protocol.
 The bulk of the application resides on the server, and its architecture is
typically composed of three layers:
◊ presentation - contains modules that are responsible for managing
user interaction
◊ business - contains modules that handle aspects related to the
business logic
◊ data layers - contains modules that manage data that is stored either
locally or remotely.
 In addition, certain functionality that is common to modules across the
layers is organized as cross-cutting concerns.
 This cross-cutting functionality includes aspects related to security,
logging, and exception management.
Chapter 5 - Microservice Development

5.18 Web Applications – Reference Architecture........................................................
Chapter 5 - Microservice Development

5.19 Web Applications – When to use?.......................................................................
 You should consider using this type of application when:
◊ You do not require a rich user interface.
◊ You do not want to deploy the application by installing anything on the
client machine
◊ You require portability of the user interface.
◊ Your application needs to be accessible over the Internet.
◊ You want to use a minimum of client-side resources.
5.20 Single Page Applications.....................................................................................
 The SPAs are web applications that have a single web page and all views
render dynamically when the user interacts with the application.
 SPAs use AJAX to call backend data through services and most of the
work is done on the client side:
Chapter 5 - Microservice Development

5.21 Single Page Applications – Benefits....................................................................
 SPAs are responsive in nature, as most of the resources, including CSS,
JavaScript, and Images, are only loaded once throughout the application
lifespan
 A SPA reduces the size of response by making AJAX requests to the
server and receives a JSON response
 SPAs make it easy to scale and cache resources
5.22 Traditional Enterprise Application Architecture..................................................
 Classical architecture
 Typical 3 layers:
◊ client-side UI (Browser, HTML + JS)
◊ a database (RDBMS, NoSQL ...)
◊ server-side application (Java, .NET, PHP, ...)
 Any changes to the system involve building and deploying a new version
of the application. Changes are expensive.
 Scaling requires scaling of the entire application, rather than parts of it that
require greater resource.
 Long release cycles.

Chapter 5 - Microservice Development

5.23 Sample Microservices Architecture.....................................................................
 Applications naturally start as Monoliths, they scale and evolve to
Microservice architecture
 Applications are decomposed to components – smaller independent
service applications.
 Components are loosely coupled.
5.24 Serverless & Event-driven Microservice – AWS Lambda..................................
 AWS Lambda is a compute service that lets you run code without
provisioning or managing servers.
 AWS Lambda executes your code only when needed and scaled
automatically, from a few requests per day to thousands per second.
 You pay only for the compute time you consume - there is no charge when
your code is not running.
 With AWS Lambda, you can run code for virtually any type of application
or backend service - all with zero administration.
 AWS Lambda runs your code on a high-availability compute infrastructure
and performs all of the administration of the compute resources, including
server and operating system maintenance, capacity provisioning and
automatic scaling, code monitoring and logging.
◊ All you need to do is supply your code in one of the languages that
Chapter 5 - Microservice Development

AWS Lambda supports (currently Node.js, Java, C# and Python).
5.25 Summary..............................................................................................................
 Small, autonomous services which work well together.
 Microservices are designed for failure
 Docker containers play a very important role in implementing
Microservices architecture
 Kubernetes provides a container orchestration solution. It has built-in
functionality for implementing fault-tolerance and load balancing.
 OpenShift makes configuration and management of Docker containers
and Kubernetes much easier.
Chapter 6 - Introduction to Spring Boot............................................................................
Objectives
Key objectives of this chapter
 Overview of Spring Boot
 Using Spring Boot for building microservices
 Examples of using Spring Boot
6.1 What is Spring Boot?.............................................................................................
 Spring Boot ( http://projects.spring.io/spring-boot/) is a project within the
Spring IO Platform ( https://spring.io/platform )
 Developed in response to Spring Platform Request SPR-9888 "Improved
support for 'containerless' web application architectures"
 Inspired by the DropWizard Java framework (http://www.dropwizard.io/)
 The main focus of Spring Boot is on facilitating a fast-path creation of
stand-alone web applications packaged as executable JAR files with
minimum configuration
 An excellent choice for creating microservices
 Originally released for general availability in April 2014
◊ ( https://spring.io/blog/2014/04/01/spring-boot-1-0-ga-released )
 Version 2 was released in Spring of 2017
Notes:

A JAR (Java ARchive) is a file format and deployment unit used to package a set of Java class files and
associated metadata and resources.

Microservices are a collection of loosely coupled services used by an application. The services are
fine-grained and the protocols are lightweight (e.g., HTTP). Services can be developed and deployed
independently. Each service runs in its own process.

Chapter 6 - Introduction to Spring Boot

6.2 Spring Framework..................................................................................................
 Simply put, the Spring framework provides comprehensive support for
developing Java applications.
 Spring Boot lets you utilize features like Dependency Injection and comes
with out of the box modules like:
◊ Spring JDBC
◊ Spring MVC
◊ Spring Security
◊ Spring AOP
◊ Spring ORM
◊ Spring Test
 These modules can drastically reduce the development time of an
application.
6.3 How is Spring Boot Related to Spring Framework?..............................................
 Unlike Spring, Spring Boot is not a framework. Instead, it’s an extension of
the Spring Framework.
 It is a way to easily create stand-alone applications with minimal or zero
configurations.
 It provides boilerplate code and annotation configuration to quick start new
spring projects.
 It provides a set of starter pom or gradle build files which one can use to
Chapter 6 - Introduction to Spring Boot

add required dependencies and also facilitate autoconfiguration.
 It provides ‘starter’ dependencies to simplify build and application
configuration
 It provides Embedded HTTP servers like Tomcat, Jetty, etc. to develop
and test our web applications very easily.
 Spring Boot provides lots of plugins to develop and test Spring Boot
Applications very easily using build tools like Maven and Gradle
6.4 Spring Boot 2.........................................................................................................
 Spring Boot version 2.5 was released in May of 2021
 Spring Boot 2.x extends version 5 of the core Spring Framework
 Java 8 (JDK 1.8) is the minimum requirement
◊ Java 11 recommended
 Provides enhanced support for reactive programming
 Actuator endpoints are now independent of Spring MVC
◊ Custom endpoints can be created
◊ Predefined endpoints are no longer configurable
 Spring Boot DAO API is now in line with JPA APIs
◊ .findOne is now called .findById
◊ .findById returns an Optional<T> instead of T
6.5 Spring Boot Main Features....................................................................................
 Spring Boot offers web developers the following features:
◊ Ability to create WAR-less stand-alone web applications that you can
run from command line
◊ Embedded web container that is bootstrapped from the public
static void main method of your web application module:
 Tomcat Servlet container is default; you have options to plug in Jetty
Chapter 6 - Introduction to Spring Boot

or Undertow containers instead
◊ Intelligent defaults which allow for minimal configuration
 Spring Boot relies on Spring MVC annotations (more on annotations
later ...) for configuration
◊ Built-in production-ready features for run-time metrics collection, health
checks, and externalized configuration
Notes:

A WAR (Web application ARchive) file is a format for and unit of packaging and distribution of Java-
based web applications that are deployed in the web container of a Java-enabled web server.

For steps how to switch from Tomcat to Jetty or Undertow, visit
http://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html

For an overview of the Spring framework, visit http://docs.spring.io/spring/docs/current/spring-
framework-reference/html/overview.html

The following diagram, borrowed from the above Spring framework link, lays out the components of a
full-fledged Spring web application:

Chapter 6 - Introduction to Spring Boot

6.6 Spring Boot on the PaaS........................................................................................
 Spring boot is designed to be conveniently run in a container. All major
cloud provider can run Docker and Kubernetes
 Older projects might use PaaS (Platform as a Service)
 PaaS offer robust, scalable, and cost-efficient run-time environments that
can be used with minimum operational involvement
 Spring's parent company is Pivotal Software Inc.
 Historically linked with VMware and Cloud Foundry
6.7 Understanding Java Annotations............................................................................
 Annotations in Java are syntactic metadata that is baked right into Java
source code; you can annotate Java classes, methods, variables and
parameters
 Basically, an annotation is a kind of label that is processed during a
compilation stage by annotation processors when the code or
configuration associated with the annotation is injected in the resulting
Java class file, or some additional operations associated with the
annotation are performed
 An annotation name is prefixed with an '@' character
 Note: Should you require to change annotation-based configuration in
your application, you would need to do it at source level and then re-build
your application from scratch
6.8 Spring MVC and REST Annotations.....................................................................
 Spring Boot leverages Spring MVC (Model/View/Controller) annotations
instead of XML-based configuration
◊ Additional REST annotations, like @RestController, have been
incrementally added to the framework
 The main Spring MVC annotations are:
◊ @Controller / @RestController – annotate a Java class as an HTTP
Chapter 6 - Introduction to Spring Boot

end-point
◊ @RequestMapping – annotate a method to configure with URL path /
HTTP verb the method responds to
◊ @RequestParam - named request parameter extracted from client
HTTP request
6.9 Example of Spring MVC-based RESTful Web Service........................................
 The following code snippet shows some of the more important artifacts of
Spring MVC annotations that you can apply to your Java class
 Note: Additional steps to provision and configure a web container to run
this module are required
// ... required imports are omitted
@RestController
public class EchoController {
@RequestMapping(path="/echoservice", method=RequestMethod.GET)
public String echoback(@RequestParam(value="id") String echo) {
return echo;
}
}
 The above annotated Java class, when deployed as a Spring MVC
module, will echo back any echo message sent with an HTTP GET
request to this URL:

http(s)://<Deployment-specific> /echoservice?id=hey

6.10 Spring Booting Your RESTful Web Service.......................................................
 Spring Boot allows you to build production-grade web application without
the hassle of provisioning, setting up, and configuring the web container
 A Spring Boot application is a regular executable JAR file that includes the
required infrastructure components and your compiled class that must
have the public static void main method which is called by the
Java VM on application submission
◊ The public static void main method references the
SpringApplication.run method that loads and activates Spring
annotation processors, provisions the default Tomcat Servlet container
Chapter 6 - Introduction to Spring Boot

and deploys the Spring Boot-annotated modules on it
6.11 Spring Boot Skeletal Application Example.........................................................
 The following code is a complete Spring Boot application based on the
Spring MVC REST controller from a couple of slides back
// ... required imports are omitted
@SpringBootApplication
@RestController
public class EchoController {
@RequestMapping(path="/echoservice", method=RequestMethod.GET)
public String echoback(@RequestParam(value="id") String echo) {
return echo;
}
public static void main(String[] args) throws Exception {
SpringApplication.run(EchoController.class, args);
}
}
 You run Spring Boot applications from command line as a regular
executable JAR file:
java -jar Your_Spring_Boot_App.jar

 The default port the Spring Boot embedded web container starts listening
on is 8080
◊ To change the default port, you need to pass a server.port System
property or specify it in the Spring's application.properties file
Notes:

The @SpringBootApplication is functionally equivalent to three annotations applied sequentially:

@Configuration, @EnableAutoConfiguration, and @ComponentScan

6.12 Starters..................................................................................................................
 Spring Boot auto-configures based on what it finds on the classpath
 So, the set of modules is determined by what's in the 'pom.xml'
 The project provides a number of 'starter' artifacts that pull in the correct
Chapter 6 - Introduction to Spring Boot

dependencies for a given technology
 Some examples:
◊ spring-boot-starter-web
◊ spring-boot-starter-jdbc
◊ spring-boot-starter-amqp
 You just need to include these artifacts in the 'pom.xml' to configure those
technologies.
6.13 Maven - The 'pom.xml' File.................................................................................
 Assuming you're building with Apache Maven, the 'pom.xml' file describes
all the artifacts and build tools that go into producing a delivered artifact.
 Generally, use the 'starter parent':

org.springframework.boot
spring-boot-starter-parent
2.2.6.RELEASE

◊ It defines all the dependency management and core dependencies for
a Spring Boot application
6.14 Maven - The 'pom.xml' File.................................................................................
 Add dependencies:


org.springframework.boot

spring-boot-starter-web


org.springframework.boot

Chapter 6 - Introduction to Spring Boot

spring-boot-starter-test

6.15 Spring Boot Maven Plugin...................................................................................
 The Maven plugin can package the project as an executable jar file, that
includes all the dependencies




org.springframework.boot


spring-boot-maven-plugin




6.16 Gradle - The 'build.gradle' File............................................................................
 To define the dependencies, use the dependencies block as shown below:
dependencies {
implementation 'org.springframework.boot:spring-boot-
starter-web '
testImplementation('org.springframework.boot:spring-boot-
starter-test')
...
}
 It defines the dependency management and core dependencies for a
Spring Boot application

Chapter 6 - Introduction to Spring Boot

6.17 Spring Boot Gradle Plugin...................................................................................
 Spring provides a standalone Spring Boot Gradle plugin which adds some
tasks and configurations to ease the work with Spring Boot based projects.
 Assuming you're building with Gradle, the 'build.gradle' file describes all
the artifacts and build tools that go into producing a delivered artifact.
plugins {
id 'org.springframework.boot' version
'2.2.6.RELEASE'
id 'io.spring.dependency-management' version
'1.0.9.RELEASE'
id 'java'
}
6.18 HOWTO: Create a Spring Boot Application.......................................................
 Create a new Maven project in the IDE of your choice
 In 'pom.xml',
◊ add the Spring Boot parent project (see above)
◊ Add dependencies to the 'starter' projects that describe the features
you want (e.g. Spring MVC, JDBC, etc)
◊ Add the 'spring-boot-maven-plugin' to the build plugins
 Add a default 'application.properties' or 'application.yml' file in
'src/main/resources'
◊ List of properties is at:
 https://docs.spring.io/spring-boot/docs/current/reference/html/
appendix-application-properties.html
 At least include 'spring.application.name'
6.19 HOWTO: Create a Spring Boot Application.......................................................
 Create a main class in src/main/java/<package>
 e.g. in 'com.mycom.app',
Chapter 6 - Introduction to Spring Boot

@SpringBootApplication
public class MyApp {
public static void main(String[] args) {
SpringApplication.run(MyApp.class, args);
}
}
 Build with 'mvn install'
 From the IDE, run the main class
 From command line, run the jar file
6.20 Spring Initializr....................................................................................................
 Spring also offers an Initializr website which can be used to create a new
Spring Boot project
◊ https://start.spring.io/
 Use it to configure whether you want to use Maven or Gradle, the Spring
Boot version, language, project metadata, Java version, packaging format
and dependencies.
 Preview the Gradle or Maven build file using the EXPLORE button.
 When done, click GENERATE button to download a zip file.
 Import the zip file into your favorite IDE.
Chapter 6 - Introduction to Spring Boot

6.21 Spring Initializr....................................................................................................
6.22 Summary..............................................................................................................
 Spring Boot eliminates many of the headaches related to provisioning,
setting up and configuring a web server by offering a framework for
running WAR-less web applications using embedded web containers
 Spring Boot favors annotation-based configuration over XML-based one
◊ Any change to such a configuration (e.g. a change to the path a REST-
enabled method responds to), would require changes at source level
and recompilation of the project
 Spring Boot leverages much of the work done in Spring MVC
Chapter 7 - Overview of Spring Boot Database Integration..............................................
Objectives
Key objectives of this chapter:
 DAO Support in Spring
 Various data access technologies supported by Spring
7.1 DAO Support in Spring..........................................................................................
 A data access object (DAO) is a mechanism to read and write data from a
database
 DAOs use underlying data access technologies such as JDBC or an ORM
framework like Hibernate
 Spring DAO support is designed so it is easy to switch from one data
access technology to another
◊ E.g. JDBC, Hibernate, JDO, etc
DAO Support in Spring

The data access object design pattern is a proven pattern in J2EE application architecture. Its primary
purpose is to provide a way of keeping upper software layers decoupled from lower level data access
technologies and infrastructural details so upper layers can concern themselves with business logic and
not have to worry about data persistence.

Spring recognizes the value of this pattern and provides a sophisticated framework based around it.

Chapter 7 - Overview of Spring Boot Database Integration

7.2 DAO Support in Spring..........................................................................................
Service
Object
DAO
Interface
DAO
Implementation
Underlying Data Access
Technology (e.g. Hibernate)
Resource
DAO implementation
is data access
technology specific
Service layer is unaware
of the underlying data
access technology
DAO Support in Spring

Spring promotes coding to interfaces and the area of DAOs is no exception. By coding service layers to
DAO interfaces, you gain at least two advantages. First, the code is easier to test. Mock DAO
implementations can more easily be swapped in during testing of service layers allowing you to fully
test a service object without the need for the real DAO implementation and all of its dependencies.

Second, using an interface allows you the flexibility of swapping in a different DAO implementation at
deployment time. For example, if you choose to change from JDBC to Hibernate as your data access
technology, your service layers are oblivious to this fact and should not need to change.

Chapter 7 - Overview of Spring Boot Database Integration

7.3 Spring Data Access Modules.................................................................................
 Spring has 2 modules providing
support for various data access
options
◊ JDBC module
◊ ORM module
 The ORM module depends
on the JDBC module
 Both modules depend on the
Spring Transaction module
◊ Data access is transactional in
nature but Spring supports this
with a separate module
7.4 Spring JDBC Module.............................................................................................
 The Spring JDBC module provides a framework and supporting classes
for simplifying JDBC code
◊ It is a good fit for applications that already use direct JDBC access and
have not migrated to some Object Relational Mapping framework
(ORM)
 The Spring JDBC module also has classes for DataSource access
◊ This includes DataSource implementations that could be used in testing
or when running an application outside a Java EE server
◊ This also includes support for an embedded database which could be
used in testing
◊ The DataSource support from this module is used even when an
application is using the Spring ORM module which is why the ORM
module depends on the JDBC module
 Much of the classes from this module used directly in applications are
some form of JdbcTemplate class
Chapter 7 - Overview of Spring Boot Database Integration

7.5 Spring ORM Module..............................................................................................
 The Spring ORM module has supporting classes for the following ORM
frameworks:
◊ Hibernate
◊ Java Persistence API (JPA)
 This is the relatively new Java standard way to do persistence
◊ Java Data Objects (JDO)
◊ iBATIS SQL maps
 An application would typically use only one of these frameworks although
the Spring ORM module contains support for all four
◊ For applications not already using one of these frameworks the JPA
standard is generally the default choice since it is a Java standard
7.6 Spring ORM Module..............................................................................................
 Code written using one of the ORM frameworks supported by Spring
typically uses the persistence framework directly
◊ Spring provides supporting classes to integrate other Spring features
like transactions with the ORM framework but these are often not seen
in the code of the application itself
◊ Spring configuration files is the area that largely contains the integration
with the ORM framework
◊ Spring has various XXXTemplate classes, like HibernateTemplate, but
these generally should NOT be used as Spring 3 can properly integrate
when the application uses the ORM API directly
7.7 DataAccessException.............................................................................................
 The Spring DAO framework insulates higher layers from technology-
specific exceptions
◊ E.g. SQLException and HibernateException
Chapter 7 - Overview of Spring Boot Database Integration

 Instead, it throws DataAccessException
◊ Root cause is still available using getCause()
 This "Exception translation" is one of the key benefits of Spring data
access support
◊ This keeps higher layers decoupled from lower level technologies
 DataAccessException is a RuntimeException
◊ RuntimeExceptions are "unchecked" which means they do not need to
be caught in order for the code to compile
◊ This is important because it means that application code is not required
to catch these Exceptions since nothing can often be done about them
anyway
 Why add a bunch of code to catch Exceptions when you aren't doing
anything except ignoring the Exception?
DataAccessException

By throwing DataAccessException from your DAO layer instead of underlying data access specific
exceptions like SQLException, you keep upper software layers decoupled from the underlying data
access technology. For example, you can change from JDBC to Hibernate without upper layers even
knowing about it because they don’t deal with SQLExceptions generated by JDBC.

Since DataAccessException is a RuntimeException, you are not forced to catch exceptions that you
probably cannot recover from. For example, if the database goes down, there probably isn’t much that
the application can do about it. Even if there is, you can still catch the exception, you just aren’t forced
to.

7.8 DataAccessException.............................................................................................
 Spring provides a hierarchy of DataAccessException subclasses
representing different types of exceptions
◊ E.g. DataRetrievalFailureException – Data could not be retrieved
 Spring converts data access technology errors to subclasses in this
hierarchy
◊ Spring understands some database specific error codes and ORM
specific exceptions
Chapter 7 - Overview of Spring Boot Database Integration

 Spring exceptions are more descriptive
DataAccessException

The Spring DataAccessException hierarchy allows higher layers to code to technology independent
exception classes, further supporting the ability to change data access technologies without impacting
higher layers. Springs exceptions can be more descriptive than the underlying database error
codes/exceptions because the creators of Spring have gone to great lengths to understand and handle
database errors from different vendors.

Some examples exceptions include:

TypeMismatchDataAccessException – Type mismatch between Java type and data type

DataIntegrityViolationException – A write operation resulted in a database integrity violation of some
kind (e.g. foreign key violation)

DeadlockLoserDataAccessException – The current process entered a database deadlock and was
chosen to be the loser

7.9 @Repository Annotation........................................................................................
 The DataAccessException translation described previously can easily be
added to a DAO implementation by adding the @Repository annotation
 This annotation is one of the Spring "stereotype" annotations for declaring
Spring components with an annotation
 This annotation is the only code that needs to be added to a class to
enable the Exception translation functionality
@Repository
public class PurchaseDAOJDBCImpl implements PurchaseDAO {

Chapter 7 - Overview of Spring Boot Database Integration

7.10 Using DataSources...............................................................................................
 Spring Boot will auto-configure a datasource based on the
'application.properties' file
spring.datasource.url=jdbc:mysql://localhost/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=com.mysql.jdbc.Driver

 All you need to do then is annotate a DataSource property with
'@Autowired'
 For extra convenience, Spring Boot also sets up a JdbcTemplate and
NamedParameterJdbcTemplate instance
◊ Again, just declare a reference to the JdbcTemplate type and annotate
it '@AutoWired'
Using DataSources

A DataSource provides Connection objects to the underlying database and often provide a connection
pool for resource management purposes.

The jndi:lookup element is new to Spring 2.x. It requires the use of the new XML schema-based
configuration syntax. In the example on the slide, a DataSource object is looked up using JNDI and
assigned to the id "dataSource".

DriverManagerDataSource is a simple data source that uses a DriverManager. It is useful for testing.
It has properties for driverClassName, url, username, and password.

7.11 DAO Templates...................................................................................................
 Data access logic often consists mostly of infrastructural code
◊ Resource management, exception handling, connection management,
etc
 Spring uses the template method pattern to provide the infrastructural
logic for you
Chapter 7 - Overview of Spring Boot Database Integration

 The developer focuses on creating the application-specific logic using a
"DAO callback"
DAO Templates

The template method design pattern is illustrated in the classic book "Design Patterns – Elements of
Reusable Object-Oriented Software" by Erich Gamma, et al (the "Gang of Four").

7.12 DAO Templates and Callbacks............................................................................
DAO Template DAO Callback
Prepare resources
Start transaction
Invoke callback
Commit/rollback
Close resources
Handle exceptions
Execute app logic
Return data
You write the
callback
DAO Templates and Callbacks

The diagram on the slide illustrates templates and callbacks. The DAO template is responsible for all
of the data access "plumbing" logic such as resource management and exception handling. Spring
provides this for you.

The DAO callback is where the application developer writes his/her application specific data access
logic.

7.13 ORM Tool Support in Spring...............................................................................
 ORM (object/relational mapping) frameworks provide functionality over
JDBC such as:
Chapter 7 - Overview of Spring Boot Database Integration

◊ Lazy loading, caching, cascading updates, etc
 Spring provides integration support for several ORM frameworks including:
◊ Hibernate, JDO, iBATIS SQL Maps, Apache OJB
 Spring also provides services on top of these frameworks including:
◊ Transaction management
◊ Exception handling
◊ Template classes
◊ Resource management
ORM Tool Support in Spring

Spring does not provide an ORM framework since several excellent frameworks already exist.
However, it does provide sophisticated integration with many of these frameworks as well as adding
additional services on top of them.

7.14 Summary..............................................................................................................
 Spring provides modules to simplify data access code
◊ These modules are some of the most used features of Spring
 No matter what technology is used Spring provides a common architecture
so it is easy to switch data access technologies with minimum impact on
the rest of an application
 The Spring @Repository annotation should be used on DAO components
to enable Spring's data Exception translation
Chapter 8 - Using Spring with JPA....................................................................................
Objectives
Key objectives of this chapter:
 Using Spring with JPA
 Spring Data JPA Repositories
 Schema Management using Liquibase
8.1 Spring JPA.............................................................................................................
 Besides basic JDBC support, Spring also provides support for ORM, or
Object Relational Mapping
◊ ORM is the ability of mapping values of Java objects in memory to
tables and columns in a database and having the environment
automatically synchronize the two
 Spring Boot provides an JPA module that provides this support


org.springframework.boot


spring-boot-starter-data-jpa


 This brings in
◊ Java Persistence (JPA)
◊ Hibernate
◊ Spring Data JPA
 Although Spring does support the "template" approach like with JDBC, you
are often using the ORM framework natively and using Spring just to
bootstrap it into the environment
Chapter 8 - Using Spring with JPA

8.2 Benefits of Using Spring with ORM....................................................................
 Simply using an ORM framework can simplify an application considerably
◊ You can simply indicate what is persisted and let the framework
calculate the actual SQL code to accomplish that
 Using Spring's ORM support in addition to an ORM framework provides
the following benefits:
◊ Spring can provide the configuration for the ORM framework as Spring
configuration which can make it easy to swap out different
configurations for testing, production, etc
◊ Spring can translate the data access exceptions of the ORM framework
into a standardized set of Spring exceptions
◊ Spring can provide access to the ORM managed resources avoiding
many common issues when used without Spring
◊ The ORM support of Spring also integrates with the transactional
support so that transactional behavior of a Spring application is
consistent and the ORM framework is integrated into this correctly
8.3 Spring @Repository.............................................................................................
 One of the Spring configuration stereotype annotations is specifically
designed for Spring components in an application that work with data
access
◊ This is the @Repository annotation
 By using this annotation (and the appropriate annotation scanning XML
configuration) you can register the Java class as a Spring component and
enable the Spring data access exception translation
◊ Java class:
@Repository
public class ProductDaoImpl implements ProductDao {
◊ Spring Boot normally includes @ComponentScan

Chapter 8 - Using Spring with JPA

◊ Spring configuration:
<context:component-scan ... />
<context:annotation-config />

Spring @Repository

In the example above there are two <context:...> elements in the XML configuration. Both of these are
required to get the detection of the @Repository annotation and the registration of the Spring data
access exception translation. The <context:component-scan ..> element is what would scan the Java
class to pick up the @Repository annotation while the <context:annotation-config /> registers the
PersistenceExceptionTranslationPostProcessor Spring class as a bean to enable exception translation.

If you want to register the exception translation Spring bean manually in XML instead of using
<context:annotation-config /> you could use the following although there is not much point to since
you are using some kind of XML configuration either way:


8.4 Using JPA with Spring.........................................................................................
 The use of JPA is based on the JPA 'EntityManager'
◊ This is the interface used to persist or query data managed by JPA
◊ Java classes that are mapped by JPA to database tables are 'Entities'
@Entity
public class Product { ...

 The EntityManager is often injected into a Spring component so that code
in the rest of the Spring component can use JPA directly
public class PurchaseDaoJpaImpl implements PurchaseDao {
@PersistenceContext
private EntityManager em;

// ...

◊ The @PersistenceContext annotation is a standard JPA annotation that
is used for injection provided the Spring <context:annotation-config />
element is in your Spring configuration
 Spring 4 can be used with JPA 2.2 as long as the JPA provider being used
Chapter 8 - Using Spring with JPA

also supports JPA 2.0
◊ Hibernate 5+ supports JPA 2.2
Using JPA with Spring

Technically it is possible to register the appropriate Spring bean post processor directly instead of using
<context:annotation-config /> to enable Spring injection of @PersistenceContext but again it is not
really beneficial to do this manually.


8.5 Configure Spring Boot JPA EntityManagerFactory............................................
 Spring Boot automatically sets up an EntityManagerFactory, so you can
just inject the EntityManager with @AutoWired or @PersistenceContext
 In Spring Boot, we don't need a 'persistence.xml' file
◊ All Entity classes are picked up by the classpath scanner.
8.6 Application JPA Code..........................................................................................
 Although Spring is providing the JPA configuration the actual code that
works with persisted data can use only the JPA API
public class PurchaseDaoJpaImpl implements PurchaseDao {
@PersistenceContext
private EntityManager em ;

public void savePurchase(Purchase purchase) {
if (getPurchase(purchase.getId()) == null) {
em .persist(purchase);
} else {
em .merge(purchase);
}
}
public List getAllPurchases() {
Query q = em .createQuery("select p from
Purchase p");

Chapter 8 - Using Spring with JPA

List<Purchase> results = (List<Purchase>)
q.getResultList();
return results;
}
Application JPA Code

The above code could also have Spring annotations at the class or method level such as @Repository or
@Transactional but this could also be configured in Spring configuration files if the goal is to not have
ANY Spring classes mentioned in the application source code.

You can have this Spring configuration in addition to the above JPA code:


<context:annotation-config/>
<bean id="myPurchaseDao" class="com.mycom.PurchaseDaoJpaImpl"/>
<!-- Various <aop:config> and <tx:advice> transaction configuration -->
instead of the following Spring annotations in the class:

@Repository

@Transactional

public class PurchaseDaoJpaImpl implements PurchaseDao {

8.7 Spring Boot Considerations.................................................................................
 Spring Boot will automatically configure an embedded database if there's
one available on the classpath
◊ H2
◊ HSQL
◊ Apache Derby
 At startup time, it runs the scripts 'schema.sql' and 'data.sql' from the
resources root.
 Override by configuring 'spring.datasource.*' in 'application.properties'
Chapter 8 - Using Spring with JPA

8.8 Spring Data JPA Repositories..............................................................................
 Spring Data JPA repositories are interfaces that you define to access data
 Spring allows you to avoid writing boilerplate code by providing a set of
Repository interfaces
 To automatically generate CRUD (Create, Retrieve, Update, Delete) style
methods for your entities, you can simply extend the
CrudRepository<T, ID> interface
◊ T corresponds with the entity type and ID corresponds with the primary
key type
 For example:
public interface PurchaseRepository extends
CrudRepository<Purchase, Long> {}

 If you need pagination capabilities too, you can instead extend
PagingAndSortingRepository instead
 If you need advanced JPA capabilities, you can extend JpaRepository
Spring Data JPA Repositories

The Repository interface is a marker interface which specifies the entity type as well as the primary key
type for that entity.

public interface Repository<T, ID> {
}
CrudRepository extends Repository and provides basic CRUD operations:

public interface CrudRepository<T, ID extends Serializable>
extends Repository<T, ID> {
S save(S entity);
T findOne(ID primaryKey);
Iterable findAll();
Long count();
void delete(T entity);
boolean exists(ID primaryKey);
// ... more functionality omitted.
}
PagingAndSortingRepository extends Repository and provides basic pagination operations:

public interface PagingAndSortingRepository<T, ID extends Serializable>
extends CrudRepository<T, ID> {
Iterable findAll(Sort sort);
Page findAll(Pageable pageable);

Chapter 8 - Using Spring with JPA

}
JpaRepository extends PagingAndSortingRepository and provides advanced JPA capabilities (e.g.,
flushing persistence context and deleting records in a batch) operations:

public interface JpaRepository<T, ID> extends PagingAndSortingRepository<T, ID>,
QueryByExampleExecutor {

void flush();
S saveAndFlush(S entity);
void deleteInBatch(Iterable entities);
void deleteAllInBatch();

}

8.9 Spring Data JPA Repositories..............................................................................
 Often times, you need custom query methods too. Spring Data can
automatically generate these for you based on the names of the methods
in your interface.
 Spring Data reads the name of the methods on your interface and
automatically creates queries to implement them
public interface CityRepository
extends Repository<City, Long> {

Page findAll(Pageable pageable);

City findByNameAndCountryAllIgnoringCase(
String name,
String country
);

}
 e.g. 'findByNameAndCountryAllIgnoringCase' provides enough information
(along with the type definitions) to synthesize a query

Spring Data JPA Repositories

See the following for more information on Spring Data JPA repositories:

https://docs.spring.io/spring-data/data-commons/docs/1.6.1.RELEASE/reference/html/repositories.html

Chapter 8 - Using Spring with JPA

8.10 Database Schema Migration..............................................................................
 Agile projects require frequent changes to the code and the database
schema
 Just like the code is version-controlled, the database schema should also
be version-controlled
 When you have multiple database instances in dev, QA, production and
you want to have a tool to automatically track the change history and apply
changes intelligently, i.e. apply the diff of current schema and final
schema.
 Tools, such as Liquibase and Flyway, are very useful when it comes to
supporting database schema migration.
 Database schema migration tools can ensure the data isn’t lost when you
update a schema.
8.11 Database Schema Migration for CI/CD using Liquibase...................................
 Liquibase is one of the most versatile tools for database migration.
 The alternate to Liquibase is Flyway.
 Liquibase works on nearly all relational database platforms, such as
MySQL, SQL Server, and Oracle.
 It performs all the DDL operations and useful database refactorings.
 You can use Liquibase to deploy database changes.
 Since Liquibase runs from a shell or command line, you can run it
manually or in any CI/CD pipeline
 Liquibase can also be integrated with Maven, Ant, and other build engines.
 Liquibase can also be integrated with Spring Boot.
Database Schema Migration for CI/CD using Liquibase

For information on integrating Liquibase with Spring Boot and Maven, see:

https://javadeveloperzone.com/spring-boot/spring-boot-liquibase-example/
#22_POM_file_configuration

Chapter 8 - Using Spring with JPA

https://www.liquibase.org/documentation/spring.html

8.12 How Liquibase Works?......................................................................................
 Changes are defined in platform-agnostic language and translated to
database platform you use.
 You keep a running list of changes, and Liquibase applies those changes
for you through its execution engine.
 It runs on Java that’s why it needs the correct JDBC driver to perform the
database update.
 Liquibase tracks changes using its own tables in your schema to ensure
consistency and to avoid corruption due to incorrectly altered changelogs.
 It records a hash of each changeset. While it’s running updates, it puts a
“lock” on your database so you can’t accidentally run two changelogs
concurrently.
8.13 Changelogs in Liquibase....................................................................................
 Changelogs are written using domain-specific languages.
 You can write them in JSON, YAML, XML, or one of a few other supported
formats, such as Groovy and Clojure.
 Changelogs consist of a series of changesets
 A changeset represents a single change to your database, e.g. creating a
table, adding a column to a table, and adding an index.
 You can also include SQL statements in a changelog.
 The changelog should be kept under source control.
 You always add a new changeset to the end of the changelog and never
alter an existing changeset.
8.14 Preconditions in Changelogs..............................................................................
 Preconditions can be attached to change logs or changesets to control the
execution of an update based on the state of the database.
Chapter 8 - Using Spring with JPA

 There are several reasons to use preconditions, including:
◊ Document what assumptions the writers of the changelog had when
creating it.
◊ Enforce that those assumptions are not violated by users running the
changelog
◊ Perform data checks before performing an unrecoverable change such
as drop_Table
◊ Control what changesets are run and not run based on the state of the
database
 Preconditions at the changelog level apply to all changesets, not just those
listed in the current changelog or its child changelogs.
8.15 Sample Empty Changelog..................................................................................
 XML


 JSON

{
"databaseChangeLog": [
]

Chapter 8 - Using Spring with JPA

}

8.16 Sample Precondition in Changelog....................................................................
{
"databaseChangeLog": [
{
"preConditions": [
{
"runningAs": {
"username": "bob"
}
}
]
},

8.17 Sample Changeset in Changelog........................................................................
 The JSON listed below creates a table named person and adds a column
named id to the table.
{
"changeSet": {
"id": "1",
"author": "bob",
"changes": [
{
"createTable": {
"tableName": "person",
"columns": [
{
"column": {
"name": "id",
"type": "int",
"autoIncrement": true,
"constraints": {
"primaryKey": true,
"nullable": false

Chapter 8 - Using Spring with JPA

},
}
},

8.18 Running Liquibase.............................................................................................
 Liquibase can be run from the command line by running:
liquibase [options] [command] [command parameters]
 Optionally, you can replace the liquibase command with:

java -jar liquibase.jar
 Standard migration command

java -jar liquibase.jar
--driver=oracle.jdbc.OracleDriver
--classpath=\path\to\classes:jdbcdriver.jar
--changeLogFile=com/example/db.changelog.xml
--url="jdbc:oracle:thin:@localhost:1521:oracle"
--username=scott
--password=tiger
update

8.19 Liquibase Commands.........................................................................................
 There are several commands supported by Liquibase. Some of the
common commands are listed below:
◊ tag <tag> - Tags the current database for future rollback
◊ update – Updates database to current version
◊ updateSQL – Writes SQL to update database to the current version to
STDOUT
◊ rollback <tag> – Rolls back database to the state it was in
◊ diff – Writes a description of differences to STDOUT
◊ dbDoc – Generates Javadoc-like documentation based on the current
database and changelog
◊ ...
Chapter 8 - Using Spring with JPA

 The complete command list is available on the official website:
https://www.liquibase.org/documentation/command_line.html
8.20 Summary............................................................................................................
 Spring provides exceptional support for various ORM frameworks
 The preferred approach in modern Spring applications is:
◊ Use the JPA API to create standards-based persistence code
◊ Use a JPA provider library (like Hibernate) to provide the JPA support
◊ Use Spring to configure JPA and link to other Spring configuration or
the environment in a Java EE server
 Spring Data JPA repositories help you avoid writing boilerplate code by
automatically generating CRUD style methods and query methods for your
entities
 Use Liquibase for database migration in your Spring Boot application
Chapter 9 - Spring REST Services...................................................................................
Objectives
Key objectives of this chapter
 A Basic introduction to REST-style services
 Principles of RESTful web service development
 Using Spring MVC to implement REST services
 Spring annotations that support RESTful APIs
 Combining the JAX-RS standard with Spring
 Look at how to configure REST based clients
9.1 REpresentational State Transfer...........................................................................
 REST stands for RE presentational S tate T ransfer
 First introduced by Roy Fielding in his thesis dissertation “Architectural
Styles and the Design of Network-based Software Architectures”
◊ Thesis was delivered in year 2000
◊ Concepts and ideas are still relevant today
 Arguably simpler and less rigid than SOAP
 Easily integrates with Ajax and JavaScript based applications
◊ Makes it a perfect fit for applications written in Ember or Angular
9.2 Principles of RESTful Services............................................................................
 Roy Fielding in his doctoral thesis tried to analyze the wild success of the
web and how can some of its architecture principles be applied to any
software. Thus RESTful services were born.
 There are four essential elements to any RESTful service
◊ Addressable resources – A URI uniquely points to a resource or
collection of resources,
◊ Uniform operations – a small number of HTTP methods (GET, POST,
Chapter 9 - Spring REST Services

PUT, DELETE) that work uniformly for all entities.
◊ Resource representation – A representation is document in a certain
format (XML, JSON etc.) that describes a resource. A consumer and
provider of services should be able to negotiate the format.
◊ Stateless – Services should be stateless. That is, a consumer should
be able to complete a business task by issuing a single HTTP request.
Principles of RESTful Services

Source: Architectural Styles and the Design of Network-based Software Architectures, Roy Thomas
Fielding, 2000. http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm.

9.3 Understanding REST...........................................................................................
 REST applies the traditional, well-known architecture of the Web to Web
Services
◊ Everything is a resource
◊ Each URI is treated as a distinct resource and is addressable and
accessible using an application or Web browser
◊ URIs can be bookmarked and even cached
 Leverages HTTP for working with resources
◊ GET, POST, PUT and DELETE methods are all used as the HTTP
protocol intended
Understanding REST

The notion of a resource “representation” is very important within REST. Technically you should
never have a direct pipeline to a resource, but rather access to a representation of a resource. For
example, a resource which represents a circle may accept and return a representation which specifies a
center point and radius, formatted in SVG, but may also accept and return a representation which
specifies any three distinct points along the curve as a comma-separated list. This would be two
distinct representations of the same resource.

Chapter 9 - Spring REST Services

9.4 Understanding REST...........................................................................................
 Leverages HTTP method for operating on resources (entities)
◊ GET – Retrieves a resource or a collection of resources. A read-only
operation
◊ DELETE – Removes a resource
◊ PUT & POST - “it depends”
 PUT & POST depend on where the resource identifier (primary key) is
determined
◊ Resource identifier is generated after the request reaches the server
 eg. an order ID generated by a database insert
 POST: Creates a resource
 PUT: Updates a resource as a whole (e.g., entire Order resource)
◊ Resource identifier is part of the data sent by the client
 eg. a flight number assigned outside the service
 PUT: Creates a new resource
 POST: Does a partial resource update (e.g., current flight status)
Understanding REST

PUT and POST are very similar methods. Both can create a new resource or update an existing
resource. Updating a resource is easier to distinguish since a PUT is used when the entire content of
the resource is being replaced and a POST is used when a partial update is performed. Which method
to use when creating a new resource depends on how the resource identifier is determined. If the
server-side REST service determines the resource identifier (perhaps auto-generated by a database)
then a POST is used with a URI that does not include any resource identifier. If the client determines
the resource identifier (perhaps by using a natural key like a social security number) then a POST is
used and the URI has the resource identifier included (as if the resource already exists).

9.5 REST Example – Create......................................................................................
 If the entity identifier is created by the service a POST request is used to
Chapter 9 - Spring REST Services

create
 Request
POST /RESTWeb /catalogs/products HTTP/1.1
Content-Type: text/xml
Content-Length: 142

125.99 Baseball bat  Response
HTTP/1.1 201 Created
Location: http://localhost/RESTWeb/catalogs/products/1029
Content-Length: 0

REST Example – Create

In this example the primary key, the product ID in this case, is generated by the service when inserting
new data and is not part of the information sent in by the client with the initial request. Because of this
the POST request is sent and the 'Location' header in the response is critical to know what address can
be used to access the created entity later.

9.6 REST Example – Retrieve...................................................................................
 A GET request should always only retrieve data
◊ A '404 Not Found' error should be returned if the data doesn't exist
 Request
GET /RESTWeb /catalogs/products/1029 HTTP/1.1
Accept: text/xml
 Response

HTTP/1.1 200 OK
Content-Type: text/xml
Content-Length: 137

Chapter 9 - Spring REST Services

125.99 Baseball bat 1029
9.7 REST Example – Update.....................................................................................
 A PUT request can update existing data
 Request
PUT /RESTWeb /catalogs/products/1029 HTTP/1.1
Content-Type: text/xml
Content-Length: 144

75.99 Baseball bat 1029  Response
HTTP/1.1 204 No Content
Content-Length: 0

REST Example – Update

Since for this service, new entities are created with a POST request, a PUT request will update an
existing entity. Note that the identifier is part of the address the request is sent to.

9.8 REST Example – Delete......................................................................................
 The DELETE request is the simplest with no body to request or response
 Request
DELETE /RESTWeb /catalogs/products/1029 HTTP/1.1

Chapter 9 - Spring REST Services

 Response
HTTP/1.1 204 No Content
Content-Length: 0

9.9 REST Example – Client Generated ID................................................................
 If the identifier for data is provided by the client, a PUT request is used to
create a new entity with the service
◊ It can also update if the entity already exists
 Request
PUT /RESTWeb /flights/AA1215 HTTP/1.1
Content-Type: text/xml
Content-Length: 150

MCO ORD On Time AA1215  Response
HTTP/1.1 201 Created
Location: http://localhost/RESTWeb/flights/AA1215
Content-Length: 0

Chapter 9 - Spring REST Services

REST Example – Client Generated ID

In the above example, if the request were updating existing data instead of creating a new entity the
request would be the same. The response would likely be a '204 No Content' status code instead of
'201 Created' to indicate the data was updated successfully. There would also be no need for a
'Location' header in the response.

9.10 REST Example – JSON.....................................................................................
 It is very common for REST services to support communication with
JSON, JavaScript Object Notation
◊ This is much easier than XML for JavaScript clients that have been very
common with REST services
 JSON uses curly brackets for the boundaries of objects along with
comma-separated name/value pairs for properties
 Request
GET /RESTWeb /catalogs/products/1029 HTTP/1.1
Accept: application/json

 Response
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 62

{
“price” : 125.99,
“name” : “Baseball bat”,
“code” : 1029
}

9.11 @RestController Annotation..............................................................................
 Spring Web provides a @RestController annotation to help support
RESTful web service development
 It combines @Controller and @ResponseBody
Chapter 9 - Spring REST Services

◊ Only one annotation needs to be added to a POJO to make it a a REST
controller class!
9.12 HTTP Request Method Mapping.......................................................................
 Methods in Spring need only be decorated with the appropriate annotation
to respond to the appropriate HTTP method:
◊ @GetMapping for GET
◊ @PostMapping for POST
◊ @PutMapping for PUT
◊ @DeleteMapping for DELETE
@GetMapping("/{customerId}")
public Optional getCustomerById() {
return repo.findById(id);
}

9.13 Path Variables and Query Parameters................................................................
 Annotations allow developers to map path variables and query parameters
to JavaBeans
◊ @PathVariable for dynamic path attributes
◊ @RequestParam for values attached to a URL
@GetMapping("/{customerId}")
public Optional getCustomerById(@PathVariable("customerId") long id) {
return repo.findById(id);
}

9.14 RequestBody and ResponseBody......................................................................
 Incoming JSON and XML will be converted into a Java object if method
arguments are annotated appropriately
◊ Use the @RequestBody annotation to map a request to an object
 Data returned from a RESTful method will typically be converted into
Chapter 9 - Spring REST Services

JSON or XML, depending on the specified content-type
◊ A ResponseEntity will return a complete HTTP response
@PutMapping("/{customerId}")
public ResponseEntity<?> putCustomer(@RequestBody Customer newCustomer,
@PathVariable("customerId") long customerId) {
if (newCustomer.getId()!=customerId
|| newCustomer.getName()==null
|| newCustomer.getEmail() == null) {
return ResponseEntity.badRequest().build();
}
newCustomer=repo.save(newCustomer);
return ResponseEntity.ok().build();
}

9.15 JAX-RS vs Spring..............................................................................................
 The JAX-RS standard uses different annotations from Spring MVC
◊ However, the APIs are similar enough that they are easily understood
 @Path annotation for linking classes or methods to the request path that
will map to them
@Path("/quotes")
public class QuoteService {
 Separate annotations for mapping to the various HTTP methods

@GET @POST @PUT @DELETE
 You can use a @PathParam annotation with a method parameter to
extract data from the URL

@Path("/thisResource/ {resourceId}" )
public String getResourceById( @PathParam ("resourceId")
String id) { ... }

JAX-RS Annotations

See the following article for a comparison chart of the JAX-RS and Spring annotations:

https://dzone.com/articles/lets-compare-jax-rs-vs-spring-for-rest-endpoints

9.16 Java Clients Using RestTemplate.......................................................................
 The most common types of clients for REST services are JavaScript and
Chapter 9 - Spring REST Services

AJAX clients
 It is perhaps common also to need to have Java code communicate with
REST services as a client
 Although REST service requests and responses are fairly simple using
basic Java APIs like the java.net package would be difficult and low-level
 JAX-RS 2.1 provides a client API, but before then did not
 Spring provides the RestTemplate class which has a number of
convenience methods for sending requests to REST services
◊ These REST services do not need to be implemented using Spring
MVC or JAX-RS
 To use the RestTemplate class in a Java client you would still need to
include the Spring MVC module in the application
9.17 RestTemplate Methods.......................................................................................
 There are many different methods and these are generally provided based
on the HTTP method that will be sent
◊ The parameters and return type differ depending on if the request body
will contain data from an object and if the response body will contain
data coming back
◊ All take a String for URL and a variable argument Object... parameter
for parameters in the URL
 DELETE methods are probably the simplest
void delete(String url, Object... urlVariables)
 GET takes no request body but returns an object for the response body

getForObject(String url, Class responseType,
Object... urlVariables)
 PUT takes a request body but returns nothing

void put(String url, Object request, Object...
urlVariables)
 POST takes a request body and can return a response body

postForObject(String url, Object request, Class

Chapter 9 - Spring REST Services

responseType, Object... uriVariables)

9.18 RestTemplate Example......................................................................................
 The following example of the Spring RestTemplate obtains an array of
Customer objects from the server
@Override
public Collection getAllCustomers() {
RestTemplate template = new RestTemplate();
Customer[] customers = template.getForObject(
customersAPIbase, Customer[].class);
return Arrays.asList(customers);
}

9.19 Testing with Postman.........................................................................................
 There are a number of browser plugins and 3rd party tools that help you
test RESTful APIs
 Postman is a popular tool that has a permissive license and allows for the
creation and testing of complex RESTful queries
9.20 Summary............................................................................................................
 Spring MVC provides basic support for implementing REST services
 Spring could also be used behind standard JAX-RS REST services
Chapter 10 - Spring Security............................................................................................
Objectives
Key objectives of this chapter
 Overview of Spring Security
 Configuring Spring Security
 Defining security restrictions for an application
 Customizing Spring Security form login, logout, and HTTPS
redirection
 Using various authentication sources for user information
10.1 Securing Web Applications with Spring Boot 2................................................
 Spring Security is a framework extending the traditional JEE
Java Authentication and Authorization Service (JAAS)
 It can work by itself on top of any Servlet-based technology
◊ It does however continue to use Spring core to configure itself
 It can integrate with many back-end technologies
◊ Support for OpenID, Kerberos, LDAP, SAML and database
 It uses a servlet-filter to control access to all Web requests
 It can also integrate with AOP to filter method access
◊ This gives you method-level security without having to actually
use EJB
10.2 Spring Security...................................................................................................
 Because it is based on a servlet-filter, it can also work with SOAP
based Web Services, RESTful Services, any kind of Web
Remoting, and Portlets
 It can even be integrated with non-Spring web frameworks such
Chapter 10 - Spring Security

as Struts, Seam, and ColdFusion
 Single Sign On (SSO) can be integrated through CAS, the
Central Authentication Service from JA-SIG
◊ This gives us access to authenticate against X.509
Certificates, OpenID (supported by Google, Facebook, Yahoo,
and many others), and LDAP
◊ WS-Security and WS-Trust are built on top of these
 It can integrate into WebFlow
 There's support for it in SpringSource Tool Suite
Notes

Security is a many-headed problem. In this course we're mostly concerned with request-level
authentication and authorization, but there's much more to deal with. Cross-Site Replay attacks, SQL
injection, Man-In-The-Middle, Denial-Of-Service and Phishing attacks are just some of the concerns a
comprehensive security offering needs to address.

The Spring Security site is:

http://static.springsource.org/spring-security/site/

10.3 Authentication and Authorization......................................................................
 Authentication answers the question “Who are you?”
◊ Includes a User Registry of known user credentials
◊ Includes an Authentication Mechanism for comparing the user
credentials with the User Registry
◊ Spring Security can be configured to authenticate users using various
means or to accept the authentication that has been done by an
external mechanism
 Authorization answers the question “What can you do?”
◊ Once a valid user has been identified, a decision can be made about
allowing the user to perform the requested function
◊ Spring Security can handle the authorization decision
Chapter 10 - Spring Security

 Sometimes this may be very fine-grained. For example, allowing a
user to delete their own data but not the data of other users
10.4 Programmatic vs Declarative Security...............................................................
 Programmatic security allows us to make fine grained security
decisions but requires writing the security code within our
application
◊ The security rules being applied may be obscured by the code
being used to enforce them
 Whenever possible, we would prefer to declare the rules for
access and have a framework like Spring Security enforce those
rules
◊ This allows us to focus on the security rules themselves and
not writing the code to implement them
 With Spring Security we have a DSL for security that enables us
to declare the kinds of rules we would have had to code before
◊ It also enables us to use EL in our declarations which gives us
a lot of flexibility
◊ This can include contextual information like time of access,
number of items in a shopping cart, number of previous
orders, etc.
10.5 Adding Spring Security to a Project...................................................................
 To use Spring Security with Spring Boot, add the following dependency to
your Maven file:

org.springframework.boot
spring-boot-starter-security

Chapter 10 - Spring Security

10.6 Spring Security Configuration...........................................................................
 If Spring Security is on the classpath, then web applications will be setup
with “basic” authentication on all HTTP endpoints.
 There is a default AuthenticationManager that has a single user called
'user' with a random password.
◊ The password is printed out during application startup
◊ Override the password with 'security.user.password' in
'application.properties'.
 To override security settings, define a bean of type
'WebSecurityConfigurerAdapter' and plug it into the configuration
10.7 Spring Security Configuration Example............................................................
@Configuration
@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)
public class ApplicationSecurity
extends WebSecurityConfigurerAdapter {

@Override
protected void configure(HttpSecurity http)
throws Exception {
http.authorizeRequests()
.antMatchers("/css/**").permitAll().anyRequest()
.fullyAuthenticated().and().formLogin()
.loginPage("/login")
.failureUrl("/login?error")
.permitAll().and().logout().permitAll();
}

@Override
public void configure(AuthenticationManagerBuilder auth)
throws Exception {
auth.inMemoryAuthentication()
.withUser("user").password("user").roles("USER");
}

}

Chapter 10 - Spring Security

10.8 Authentication Manager.....................................................................................
 The AuthenticationManager class provides user information
◊ You can use multiple <authentication-provider> elements and they will
be checked in the declared order to authenticate the user
 In the example above, the WebSecurityConfigurerAdapter's 'configure()'
method gets called with an AuthenticationManagerBuilder.
 We can use this to configure the AuthenticationManager using a “fluent
API”
◊ auth.jdbcAuthentication().dataSource(ds).withDefaultSchema()
◊ See the Spring Security JavaDocs for more details.
10.9 Using Database User Authentication.................................................................
 You can obtain user details from tables in a database with the
jdbcAuthentication() method
◊ This will need a reference to a Spring Data Source bean configuration
auth.jdbcAuthentication().dataSource(ds).withDefaultSchema()
 If you do not want to use the database schema expected by Spring
Security you can customize the queries used and map the information in
your own database to what Spring Security expects
auth.jdbcAuthentication()
.dataSource(securityDatabase)
.usersByUsernameQuery(
"SELECT username, password, 'true' as enabled " +
"FROM member " +
"WHERE username=?")
.authoritiesByUsernameQuery(
"SELECT m.username, mr.role as authority " +
"FROM MEMBER m, MEMBER_ROLE mr WHERE m.username=? " +
"AND m.id=mr.member_id");

Chapter 10 - Spring Security

Using Database User Authentication

The configuration of the 'securityDatabase' Data Source above is not shown but it is just like Spring
database configuration.

The queries that Spring Security uses by default are:

SELECT username, password, enabled FROM users WHERE username =?
SELECT username, authority FROM authorities WHERE username =?

The default statements above assume a database schema similar to:

CREATE TABLE USERS (
USERNAME VARCHAR(20) NOT NULL,
PASSWORD VARCHAR(20) NOT NULL,
ENABLED SMALLINT,
PRIMARY KEY (USERNAME)
);
CREATE TABLE AUTHORITIES (
USERNAME VARCHAR(20) NOT NULL,
AUTHORITY VARCHAR(20) NOT NULL,
FOREIGN KEY (USERNAME) REFERENCES USERS
);

Notice in the custom queries defined in the slide the 'enabled' part of the query is mapped as 'true' since
it is assumed the table referenced does not have this column but Spring Security expects it. If the table
does have some column similar to 'enabled' it should map to a boolean type (like a '1' for enabled and
'0' for disabled).

The custom queries above would work with a database schema of:

CREATE TABLE MEMBER (
ID BIGINT NOT NULL,
USERNAME VARCHAR(20) NOT NULL,
PASSWORD VARCHAR(20) NOT NULL,
PRIMARY KEY (ID)
);
CREATE TABLE MEMBER_ROLE (
MEMBER_ID BIGINT NOT NULL,
ROLE VARCHAR(20) NOT NULL,
FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER
);

10.10 LDAP Authentication.......................................................................................
 It is common to have an LDAP server that stores user data for an entire
organization
 The first step in using this with Spring Security is to configure how Spring
Security will connect to the LDAP server with the ldapAuthentication
builder
Chapter 10 - Spring Security

auth.ldapAuthentication()
.contextSource()
.url("ldap://localhost").port(389)
.managerDn("cn=Directory Admin")
.managerPassword("ldap");
 You can also use a "embedded" LDAP server in a test environment by not
providing the 'url' attribute and instead providing ldif files to load

LDAP Authentication

The 'manager-dn' and 'manager-password' attributes of <ldap-server> are used for how to authenticate
against the LDAP server to query user details.

If using the embedded LDAP server the default for the 'root' will be "dc=springframework,dc=org" if
you do not supply a value.

In order to configure Spring Security there are a number of attributes related to LDAP that have various
defaults that may affect how your LDAP configuration behaves. This slide is meant to simply
introduce the feature. One step you should take when attempting to use Spring Security with LDAP is
to avoid configuring everything at once. Start with an embedded list of users to test the other
configuration settings and then switch to using LDAP. Also try using the embedded LDAP server with
an ldif file exported from your LDAP server with a few sample users.

10.11 What is Security Assertion Markup Language (SAML)?................................
 Security Assertion Markup Language (SAML) is an open standard that
allows identity providers (IdP) to pass authorization credentials to service
providers (SP).
 It’s a security protocol similar to OpenId, OAuth, Kerberos etc
 SAML is the link between the authentication of a user’s identity and the
authorization to use a service.
 SAML adoption allows IT shops to use software as a service (SaaS)
solutions while maintaining a secure federated identity management
system.
 SAML enables Single-Sign On (SSO), which means users can log in once,
and those same credentials can be reused to log into other service
providers.
Chapter 10 - Spring Security

10.12 What is a SAML Provider?..............................................................................
 A SAML provider is a system that helps a user access a service they
need.
 There are two primary types of SAML providers, service provider, and
identity provider.
◊ A service provider needs the authentication from the identity provider to
grant authorization to the user.
◊ An identity provider performs the authentication that the end user is
who they say they are and sends that data to the service provider along
with the user’s access rights for the service.
 Microsoft Active Directory or Azure are common identity providers.
Salesforce and other CRM solutions are usually service providers, in that
they depend on an identity provider for user authentication.
10.13 Spring SAML2.0 Web SSO Authentication....................................................
 This diagram from wikipedia explains how SAML works
Chapter 10 - Spring Security

1.User hits the Service Provider URL Service provider discovers the IDP to contact for
authentication
2.Service provider redirects to the corresponding IDP
3.User hits the IDP and identifies the user
4.IDP redirects to the Login form
5.Redirect to Service provider Assertion consumer URL (the URL in Service provider that
accepts SAML assertion)
6.SP initiates redirect to target resource
7.Browser requests for the target resource
8.Service provider responds with the requested resource
10.14 Setting Up an SSO Provider.............................................................................
 For SAML authentication to work we need an identity provider (IdP).
 There are various providers, such as Active Directory, Azure, AWS,
Google, Microsoft, Facebook, Onelogin, etc
 Obtain the domain name and fully qualified domain name of the Active
Directory server.
 To enable SSO on Active Directory, the following steps are typically
performed:
◊ Ensure that LDAP is configured on the Active Directory (AD) server:
◊ From the AD Server, run ldp.
◊ From the Connections menu, click Connect, and configure Server
name, port, and select SSL option.
◊ When the LDAP is properly configured, the external domain server
details are displayed in the LDP window. Otherwise, an error message
appears indicating that a connection cannot be made using this feature.
◊ When the LDAP is properly configured, the external domain server
details are displayed in the LDP window. Otherwise, an error message
appears indicating that a connection cannot be made using this feature.
10.15 Adding SAML Dependencies to a Project.......................................................
 To use SAML, add the following dependencies to your Maven file:
Chapter 10 - Spring Security


org.springframework.boot
spring-boot-starter-security


org.springframework.security.extensions
spring-security-saml2-core
1.0.10.RELEASE

10.16 SAML vs. OAuth2...........................................................................................
 OAuth is a slightly newer standard that was co-developed by Google and
Twitter to enable streamlined internet logins.
 OAuth uses a similar methodology as SAML to share login information.
 SAML provides more control to enterprises to keep their SSO logins more
secure, whereas OAuth is better on mobile and uses JSON.
 Facebook and Google are two OAuth providers that you might use to log
into other internet sites.
10.17 OAuth2 Overview............................................................................................
 OAuth is an authorization method to provide access to resources over the
HTTP protocol.
 It can be used for authorization of various applications or manual user
access
 It is commonly used as a way for internet users to grant websites or
applications access to their information on other websites without giving
them the passwords.
 This mechanism is used by companies, such as Google, Facebook,
Microsoft, Twitter, and DropBox, to permit the users to share information
about their accounts with third party applications or websites.
 It allows an application to have an access token
 Access token represents a user's permission for the client to access their
Chapter 10 - Spring Security

data
 The access token is used to authenticate a request to an API endpoint
10.18 OAuth – Facebook Sample Flow.....................................................................
 Although, the diagram below is for Facebook, but it’s similar for any other
provider.
10.19 OAuth Versions................................................................................................
 There are two versions of OAuth authorization
◊ OAuth 1 – HMAC-SHA signature strings
◊ OAuth 2 – tokens over HTTPS
 OAuth2 is not backwards compatible with OAuth 1.0.
 OAuth2 provides specific authorization flows for web applications, desktop
applications, mobile phones, and living room devices.
Chapter 10 - Spring Security

10.20 OAuth2 Components........................................................................................
 Resource server – the API server which contains the resources to be
accessed
 Authorization server – provides access tokens. It can be the same as the
API server
 Resource owner – access tokens are provided by the resource owner, i.e.
the user, when resources are accessed
 Client / consumer – an application using the credentials
10.21 OAuth2 – End Points.......................................................................................
 The token Endpoint is used by clients to get an access token from the
authorization server
 It can also optionally refresh the token
10.22 OAuth2 – Tokens.............................................................................................
 The two token types involved in OAuth2 authentication are:
◊ Access Token – used for authentication an authorization to get access
to the resources from the resource server
◊ Refresh Token – sent together with the access token. It is used to get a
new access token, when the old one expires. It allows for having a
short expiration time for access tokens to the resource server and a
long expiration time for access to the authorization server.
 Access tokens also have a type which defines how they are constructed
◊ Bearer Tokens – uses HTTPS security and the request is not signed or
encrypted. Possession of the bearer token is considered authentication
◊ MAC Tokens – more secure than bearer tokens. MAC tokens are
similar to signatures, in that they provide a way to have partial
cryptographic verification of the request.
Chapter 10 - Spring Security

10.23 OAuth – Grants................................................................................................
 Methods to get access tokens from the authorization server are called
grants
 The same method used to request a token is also used by the resource
server to validate a token
 There are 4 basic grant types:
◊ Authorization Code – when the resource owner allows access, an
authorization code is then sent to the client via browser redirect, and
the authorization code is used in the background to get an access
token. Optionally, a refresh token is also sent. This grant flow is used
when the client is a third-party server or web application, which
performs the access to the protected resource.
◊ Implicit – it's similar to authorization code, but instead of using the code
as an intermediary, the access token is sent directly through a browser
redirect. This grant flow is used when the user-agent will access the
protected resource directly, such as in a rich web application or a
mobile app.
◊ Resource Owner Credentials – the password / resource owner
credentials grant uses the resource owner password to obtain the
access token. Optionally, a refresh token is also sent. The password is
then authenticated.
◊ Client Credentials – the client's credentials are used instead of the
resource owner's. The access token is associated either with the client
itself, or delegated authorization from a resource owner. This grant flow
is used when the client is requesting access to protected resources
under its control
10.24 Authenticating Against an OAuth2 API..........................................................
 Most OAuth2 services use the /oauth/token URI endpoint for handling all
OAuth2 requests
 The first step in authenticating against an OAuth2 protected API service is
exchanging your API key for an Access Token.
Chapter 10 - Spring Security

 It can be done by performing these steps:
◊ Create a POST request
◊ Supply grant_type=client_credentials in the body of the request
 Let's say the API key has two components
◊ ID:xxx
◊ Secret: yyy
 cURL could be used to get an Access Token like this:
curl --user xxx:yyy --data grant_type=client_credentials -X
POST https://api.someapi.com/oauth/token

Authenticating Against an OAuth2 API

To be able to view sample OAuth2 requests and responses, try out:

https://developers.google.com/oauthplayground/

10.25 OAuth2 using Spring Boot – Dependencies....................................................
 Maven dependencies

org.springframework.boot
spring-boot-starter-oauth2-client


org.springframework.boot
spring-boot-starter-oauth2-resource-server</
artifactId>

10.26 OAuth2 using Spring Boot – application.yml..................................................
 src/main/resources/application.yml requires security configuration
 Note: This example uses the Facebook provider.
security:

Chapter 10 - Spring Security

oauth2:
client:
clientId: 233668646673605
clientSecret: 33b17e044ee6a4fa383f46ec6e28ea1d
accessTokenUri: https://graph.facebook.com/oauth/access_token
userAuthorizationUri: https://www.facebook.com/dialog/oauth
tokenName: oauth_token
authenticationScheme: query
clientAuthenticationScheme: form
resource:
userInfoUri: https://graph.facebook.com/me

10.27 OAuth2 using Spring Boot – Main Class.........................................................
@SpringBootApplication
@EnableOAuth2Sso
@RestController
public class DemoApplication extends WebSecurityConfigurerAdapter {

@RequestMapping("/user")
public Principal user(Principal principal) {
return principal;
}

@Override
protected void configure(HttpSecurity http) throws Exception {
http
.antMatcher("/")
.authorizeRequests()
.antMatchers("/", "/login", "/webjars/**")
.permitAll()
.anyRequest()
.authenticated()
.and()
.logout()
.logoutSuccessUrl("/")
.permitAll()
.and()
.csrf()
.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
}
// ...

10.28 OAuth2 using Spring Boot – Single Page Application Client.........................
 The sample code below uses AngularJS, but you can use similar concepts
with or without client-side framework
angular.module("app", [])

Chapter 10 - Spring Security

.controller("home", function($http) {
var self = this;

self.logout = function() {
$http.post('/logout', {}).success(function() {
self.authenticated = false;
$location.path("/");
}).error(function(data) {
console.log("Logout failed")
self.authenticated = false;
});
};

$http.get("/user").success(function(data) {
self.user = data.userAuthentication.details.name;
self.authenticated = true;
}).error(function() {
self.user = "N/A";
self.authenticated = false;
});
});

10.29 JSON Web Tokens...........................................................................................
 A replacement for standard/traditional API keys
 It is an open standard
 Allow fine-grained access control via “claims”
◊ A claim is any data a client “claims” to be true
◊ Typically includes “who issued the request”, “when it was issued”, ...
 Cross-Domain capable (cookies are not)
 Compact (compared with XML based security)
 Encoded (URL-Safe)
 Signed (to prevent tampering)
 OAuth and JWT are not the same
Chapter 10 - Spring Security

◊ JWT is a specific protocol for a security access token
◊ OAuth is a broader security framework for the interaction of different
actors (end users, back-end APIs, authorization servers) for the
generation and distribution of security access tokens
10.30 JSON Web Token Architecture.......................................................................
 Three sections
◊ Header
◊ Payload
◊ Signature
 Header and Payload are base64 encoded
 Signature is calculated from the encoded header and payload
 Sections are separated by a period
10.31 How JWT Works..............................................................................................
 JWT works as a two way protocol where a request is made and the
response is generated from a server
 The browser makes the request for JWT encoded data
 The server generates the signed token and return to the client
 The token can be sent over the http request for every other request that
Chapter 10 - Spring Security

needs authentication on the server.
 The server then validates the token and, if it's valid, returns the secure
resource to the client.
10.32 JWT Header.....................................................................................................
 Declares the signature algorithm and type
{
"typ":"JWT",
"alg":"HS256"
}
 The algorithm shown here (HMAC SHA-256) will be used to create the
signature.
 The type “JWT” stands for JSON Web Token
 When base64 encoded it looks like this:

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

10.33 JWT Payload....................................................................................................
 The payload contains “Claims”
 Claims come in several types
◊ Registered
◊ Public
◊ Private
 Examples of Registered claims
include
◊ iss: use to define who issued
the token
◊ sub: the subject of the token
◊ exp: token expiration time
 Public claims
◊ Use URI schemes to prevent
name collision
◊ i.e.
https:/corpname.com/jwt_claim
s/is_user
 Private claims
◊ For use inside organizations
◊ Can use simple naming
conventions
◊ i.e. “department”
Chapter 10 - Spring Security

10.34 JWT Example Payload.....................................................................................
 Example:
{
"iss": "corpname.com",
"aud": "corpname.com/rest/product",
"sub": "jdoe",
"Email": "jdoe@corpname.com"
}
 After base64 encoding:

eyJpc3MiOiJjb3JwbmFtZS5jb20iLCJhdWQiOiJjb3JwbmFtZS5jb20vcmV
zdC9wcm9kdWN0Iiwic3ViIjoiamRvZSIsIkVtYWlsIjoiamRvZUBjb3Jwbm
FtZS5jb20ifQ

10.35 JWT Example Signature..................................................................................
 The signature is created from the header and body like this:
content = base64UrlEncode(header)

"."
base64UrlEncode(payload);
signature = HMACSHA256(content);
 Completed signature:
pEonrJLKkpSvAMk5dmBYoxP5hZ0ZhKcnkLJYNNlVxipSoZbCnDrhSq8Psda
5dPqyjnLasPY7pyxoRKx99HAVu8L9hwdO_h9GZ6K443Xvb6uDSMsyvqQp8v
65Rv0SjUenWQRK7INyZ2N8rkHdEaMOOiOPFp7yHLUo8Tq_AM2Q

10.36 How JWT Tokens are Used.............................................................................
 Client requests token
◊ Sends credentials to Authentication server
◊ Server returns a JWT token
 Client adds token to HTTP request via the Authentication header.
◊ A JWT token can be cached on the browser and returned on every
request to the server to ensure the user has access to the resources on
every request without authentication on every request.
Chapter 10 - Spring Security

◊ The downside of this is that the user will have access for the duration of
the token unless there is a blacklist each service checks against.
 Client sends the request
 API receives request:
◊ Reads the JWT from the Authentication header
◊ Unpacks the payload
◊ Checks claims
◊ Allows or denies access
10.37 Adding JWT to HTTP Header.........................................................................
 After obtaining a JWT token the client adds it to an HTTP request as an
HTTP header
◊ Header Name: Authorization
◊ Type: Bearer
 Example:
Authorization:Bearer
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJjb3JwbmFtZS
5jb20iLCJhdWQiOiJjb3JwbmFtZS5jb20vcmVzdC9wcm9kdWN0Iiwic3ViI
joiamRvZSIsIkVtYWlsIjoiamRvZUBjb3JwbmFtZS5jb20ifQ.pEonrJLKk
pSvAMk5dmBYoxP5hZ0ZhKcnkLJYNNlVxipSoZbCnDrhSq8Psda5dPqyjnLa
sPY7pyxoRKx99HAVu8L9hwdO_h9GZ6K443Xvb6uDSMsyvqQp8v65Rv0SjUe
nWQRK7INyZ2N8rkHdEaMOOiOPFp7yHLUo8Tq_AM2Q

10.38 How The Server Makes Use of JWT Tokens...................................................
 The RESTful web service needs to validate JWT tokens when it receives
requests.
 Process
◊ Unpack token
◊ Validate that signature matches header and payload
◊ Validates claims (has token expired?)
Chapter 10 - Spring Security

◊ Compares scopes
◊ If required it makes call to ACL (access control list) server.
◊ Grants or denies access
 This process can be coded into JEE Servlet filters or added directly to the
web service code
10.39 What are “Scopes”?..........................................................................................
 The payload area of a JSON web token contains a "claim" named "scope"
 The value for the “scope” field is an array.
 Example:
"scope": [ "app.feature" ]
"scope": [ "HR.review " ]

 Technically scope strings can include any text.
 In practice scope strings are limited to those defined by an organization.
 Scope strings refer to specific operations on a specific API endpoints.
10.40 JWT with Spring Boot – Dependencies...........................................................
 Detailed JWT implementation with Spring Boot is covered in the course
project.
 Add JWT dependencies

org.springframework.boot
spring-boot-starter-security


io.jsonwebtoken
jjwt
0.9.1

Chapter 10 - Spring Security

10.41 JWT with Spring Boot – Main Class...............................................................
@EnableWebSecurity
public class SecurityTokenConfig extends WebSecurityConfigurerAdapter {

@Override
protected void configure(HttpSecurity http) throws Exception {
http
.csrf()
.disable()
// Add a filter to validate the tokens with every request
.addFilterAfter(
new JwtTokenAuthenticationFilter(jwtConfig),
UsernamePasswordAuthenticationFilter.class)
// authorization requests config
.authorizeRequests()
// allow all who are accessing "auth" service
.antMatchers(HttpMethod.POST, jwtConfig.getUri()).permitAll()
// must be an admin if trying to access admin area
// (authentication is also required here)
.antMatchers("/gallery" + "/admin/**").hasRole("ADMIN")
// Any other request must be authenticated
.anyRequest()
.authenticated();
}

// ...

10.42 Summary..........................................................................................................
 Spring Security has many features that simplify securing web applications
 Making use of many of these features only requires configuration in a
Spring configuration file
 Spring Security can work with many different sources of user and
permission information
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI
Objectives
Key objectives of this chapter
 Agile Development
 Continuous Integration
 Continuous Delivery
 Continuous Code Quality
 History of Jenkins
11.1 Foundation of Agile AppDev.............................................................................
 Agile Development begins with Extreme Programming (XP)
◊ Invented/Promoted by Kent Beck and associates
 Beck describes XP as:
◊ A philosophy of software development based on the values of
communication, feedback, simplicity, courage, and respect
◊ A body of practices proven useful in improving software development.
◊ A set of complementary principles, intellectual techniques for translating
the values into practice, useful when there isn't a practice handy for
your problem.
◊ A community that shares these values and many of the same practices.
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.2 XP Flow.............................................................................................................
11.3 Extreme Programming.......................................................................................
 As time went on, people took inspiration from XP and developed other
approaches with much the same goals
◊ Speed
◊ Include the Customer Early
◊ Don't wait until you understand the entire problem - you'll understand it
while you fix it
◊ Deliver usable value at every iteration
◊ Make reasonable use of modeling and development tools
11.4 Agile Development............................................................................................
 Two themes emerge from XP and Agile Development
◊ Trust
 Vendor, customer, managers, developers all need to trust each other
◊ Automation
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

 If we're going to go fast, we need tools that make it easy to produce
software
 Trust is a social problem – solution is all about different approaches to
process, requirements gathering, project management, etc.
 Automation is about tools – and Continuous Integration is a primary tool of
Agile Development
11.5 What is Continuous Integration.........................................................................
 “Integrate and test changes after no more than a couple of hours.”
 Beck & Andres “Extreme Programming Explained”
◊ Integrate and build the complete product, atomic build product
◊ If a website, build the website packaging, e.g. .NET, J2EE EAR
◊ If a Javascript development, package the scripts and any configuration
files
11.6 What is Continuous Integration (cont'd)............................................................
 Purposes
◊ You find out quickly about integration problems
◊ Immediately evident if a code change “breaks the build”
◊ Prevents a long drawn-out integration step at the end of code changes
◊ Should be complete enough that eventual first deployment of the
system is “no big deal”.
11.7 What is Continuous Integration (cont'd)............................................................
 Usually, CI goes along with Test-First design and automated QA
◊ Run the unit-test suite and smoke testing to ensure the build isn’t
broken
 Clearly, automatic build is a prerequisite
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

◊ So we need a build system – Maven for instance
 Can be synchronous or asynchronous
◊ Asynchronous – Integration happens automatically on code committal
◊ Synchronous – Trigger the build manually after a development session
11.8 What is Continuous Integration (cont'd)............................................................
 Side Effects
◊ Generate development reports
◊ Install to QA, User Test, etc
◊ Always have an install-able artifact
 It’s a great time to generate development metrics
◊ E.g. Code Coverage, Standards Compliance, Static Analysis
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.9 Typical Setup for Continuous Integration..........................................................
11.10 Setup Notes for Continuous Integration...........................................................
 Notes:
◊ CI system gets the code directly from version control
◊ Build is independent of any local artifacts that are on the developer’s
machine
 Controlled links to corporate repository and Maven Central
 Goal is to ensure that the package can be built from the corporate
repository
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

◊ Jenkins can have connections to a deployment environment
 Production Staging
 User Acceptance Testing
 QA
 Load Test
 Etc...
◊ It turns out that if we use Maven, we ABSOLUTELY NEED a local
repository manager
 More info to follow...
11.11 CI with Artifact Management..........................................................................
11.12 What is Continuous Delivery?.........................................................................
 Using the definition from DevOps thought leader Martin Fowler
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

 Continuous Delivery is a software development discipline where you build
software in such a way that the software can be released to production at
any time.
 You’re doing continuous delivery when:
◊ Your software is deployable throughout its lifecycle
◊ Your team prioritizes keeping the software deployable over working on
new features
◊ Anybody can get fast, automated feedback on the production readiness
of their systems any time somebody makes a change to them
11.13 Why Continuous Delivery?..............................................................................
◊ CD extends CI into readiness for deployment and operations
◊ Agile/XP speeds up the development process
 Include the Customer or Voice of the Customer
 Ensure releasable artifact after every iteration
◊ Nonetheless, Agile/XP releases fit into the standard Software
Development Life Cycle
 A release engineering and deployment process follows the
development process.
 Reflects traditional split between development and operations
Continuous Delivery

Continuous Delivery, or CD extends the idea of continuous integration into the deployment and
operations realm.

Although Agile Development and Extreme Programming seek to speed up the development process,
they originally viewed development as one piece of the traditional Software Development Life Cycle
(SDLC). XP tries to include the customer (or at least the "voice of the customer") in the development
process, and tries to make sure that we have a deliverable artifact at the end of every iteration.

Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

Nonetheless, there's an expectation that a formal release process will follow that iteration. This model
reflects the traditional split between development and operations.

11.14 DevOps and Continuous Delivery...................................................................
◊ Managing deployments and development across horizontally-scaled
environments is complex
 We have to deploy more than one server/image/container
 Requires tight control of the process
 Requires automation of development, deployment and monitoring
 Along with the technologies of virtualization, cloud, etc.
◊ This is the central theme of DevOps - Integrated provision of services
using appropriate technology and processes
◊ Deploy software as fast as we create it, while maintaining quality,
traceability and accountability
DevOps and Continuous Delivery

Managing application deployments and rapid application development across these sophisticated,
horizontally-scaled environments requires tight control of the process and significant automation, as
reflected in the "DevOps" movement. Much of this effort is aimed at being able to deploy software as
fast as we develop it, while maintaining quality, trace-ability, and accountability.

11.15 Continuous Delivery Challenges......................................................................
◊ More than one department/group involved, not just Developers
 QA, Compliance, Business Customers, etc
◊ CI job takes a few minutes, CD process could extend over days
 Could also include human input, manual tests, acceptance tests, etc
◊ Extended cycle means we have multiple process instances "in flight"
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

 "Version 6" part-way through User Acceptance Testing, while work
continues on "Version 7"
◊ Multiple resources and test/deployment environments involved
 "Version 6" goes on to Performance Validation
 "Version 7" moves into User Acceptance Testing
 Meanwhile, development gets going on "Version 8"
Continuous Delivery Challenges

Continuous Delivery extends the ideas of Continuous Integration to cover the release engineering
process and deployment of software into the production operating environment.

From an automation perspective, things change a little when we look to Continuous Delivery.

There is probably more than one group involved. Not just development, but perhaps product
management, quality assurance, regulatory compliance and others.
Whereas CI can be automated to be essentially a batch job, taking at most a few minutes, the
release engineering process followed by deployment may take days.
Because of the extended cycle, we are more likely to have multiple instances of the process "in
flight" at any given time.
The multiple instances of the release process are likely to include multiple resources and
deployment environments.
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.16 Continuous Delivery vs Continuous Deployment............................................
11.17 DevOps and Continuous Code Quality............................................................
 Continuous Code Quality plays a very important role in DevOps
 Application/software should be tested
 Test types: unit tests, integration tests, functional tests, smoke tests, ...
 Continuous quality assurance also involves checking the code quality
 Code quality can be checked by using software, such as SonarQube,
Clover, and FxCop
 A code quality tool, such as SonarQube, not only checks for bugs but for
other metrics as well. It's called the Seven Axes of Quality by the
developers.
 The Seven Axes of Quality are:
◊ Potential bugs
◊ Coding rules
◊ Tests
◊ Duplication
◊ Comments
◊ Architecture and design
◊ Complexity
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.18 What Does Continuous Delivery Mean?..........................................................
 We'll use the definition from Martin Fowler, a DevOps
master craftsperson
◊ Continuous Delivery is a software development
discipline where you build software in such a way that
the software can be released to production at any time
 Core idea of CD is creation of a repeatable, reliable and
agile SDLC process from ideation to client
 Goals are sustainability, agility, and repeatability
11.19 Deployment Pipelines......................................................................................
 Vehicle for continuous delivery
 Tasks separated by stages
 Implement various testing techniques and processes
 Support Shift-Left
 Task orchestration AKA Application Release
Automation
11.20 Your Organization is Doing CD if
 Software is deployable throughout its life-cycle
 Team prioritizes keeping the app deployable over working on new features
 Automated feedback is available to anybody on the production readiness
of any system at any time when anyone makes a change
 Deployments can be kicked off by a push of a button for any version of the
software to any environment on request
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.21 Pipelining for CD.............................................................................................
 Build
 Static code analysis
 Continuous Integration
 Release management
 Deployment
 Testing
◊ Regression
◊ Smoke
◊ Performance
◊ Business Validation & Verification
11.22 Continuous Integration.....................................................................................
 Continuous Integration is a software development practice where
members of a team integrate their work frequently
 Each person integrates daily – ensuring that the component is still build
and deployment ready
 Each integration is verified by an automated build (including smoke
testing) to detect integration errors at the earliest stage
 This approach should lead to a significantly reduced integration problems
and allow the team to develop software with better agility and reliability –
Shift Left
11.23 CI Pipeline........................................................................................................
 Break build, release, and testing into stages including environmental
complexity
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

 Each progressive stage provides additional detail and confidence on
components and microservices
◊ Build, compilation, dependency validation
◊ Deployment to dev/test
◊ Smoke testing
◊ Progress through environments
◊ ( dev, staging, QA, ...)
◊ Production release
11.24 CD & CI Methodologies..................................................................................
 Enable automation of the build early
 Front-load creation of a Dev server environment
 Include unit testing on the Dev server
 Quickly stand up production-like environment, e.g. clustered, integration
points, roles, and permissions
 Agile methodology
 Ensure development, architecture, governance, security, operations,
test/QA, and business or product team members are engaged
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

11.25 Key Tool Categories for CI/CD.......................................................................
 Monitoring
 Automation
 Configuration Management
 Build Management
 Version Control
 Notification
 Testing
 Knowledge Management
 Orchestration
Don't leave out your Database, Performance, Governance, Security and QA
folks in these tool considerations

11.26 Enterprise DevOps Playbook...........................................................................
 When following DevOps at BAH, refer to Enterprise DevOps Playbook
 The DevOps Playbook recommends the principles, practices, and roles
 It also recommends various metrics which should be captured and
checklists to assess your DevOps maturity level
 It recommends the following DevOps principles:
◊ Treat operations as first-class citizens
◊ Developers act as first responders to issues with the production system
◊ Shorten the time between identification of a production issue and its
repair
◊ Shorten the time between code commit and code deploy
◊ Minimize coordination to deploy releases
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

◊ Stop and fix potential defects identified by continuous flow and
monitoring
◊ Enforce standardized processes to ensure predictable outcomes
◊ Become a learning organization through continual feedback and action
11.27 Enterprise DevOps Playbook (Cont'd).............................................................
 The DevOps Playbook recommends the following DevOps roles:
◊ The DevOps architect
◊ The DevOps engineer
◊ The test automation engineer
◊ The site reliability engineer
◊ The software engineer
11.28 Enterprise DevOps Playbook (Cont'd).............................................................
 The DevOps Playbook recommends the following practices:
◊ Configuration management
◊ Continuous integration
◊ Automated testing
◊ Infrastructure as Code
◊ Continuous delivery
◊ Continuous deployment
◊ Continuous monitoring
11.29 Jenkins Continuous Integration........................................................................
 Originally developed at Sun by Kohsuke Kawaguchi
◊ Originally “Hudson” on java.net circa 2005
◊ Jenkins forked in November 2010
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

◊ Hudson is still live, part of Eclipse Foundation
◊ But Jenkins seems to be far more active
11.30 Jenkins Features...............................................................................................
 Executes jobs based on a number of triggers
◊ Change in a version control system
◊ Time
◊ Manual Trigger
 A Job consists of some instructions
◊ Run a script
◊ Execute a Maven project or Ant File
◊ Run an operating system command
 User Interface can gather reports
◊ Each job has a dashboard showing recent executions
 Jenkins 2 adds the "Pipeline"
◊ Orchestrate Continuous Delivery processes more easily
11.31 Running Jenkins...............................................................................................
 You can run Jenkins Standalone or inside a web container
 You can setup distributed instances that cooperate on building software
 Can setup jobs in place of what might have been script commands.
11.32 Hotfixes............................................................................................................
 By default, Jenkins builds master branch of a Git repository. Typically,
each time a change is made to the repository, a build is triggered
automatically.
 When hotfixes are implemented, they are checked in to hotfix branch and
Chapter 11 - Introduction to Continuous Integration, Continuous Delivery and Jenkins-CI

the build is triggered manually.
 If the hotfix works, the code is merged in to master branch.
 An easy solution to build master branch by default and hotfix branch
manually is to set up a parameterized build in Jenkins.
◊ a String parameter (e.g. BRANCH) can be added which default to
master branch
◊ In Branches to Build, rather than using the default master branch, use $
{BUILD} parameter.
◊ When the build is triggered automatically, it would use master branch
and when the build is performed manually, you can switch to hotfix
branch.
11.33 Summary..........................................................................................................
 Continuous Integration is a powerful tool for agile software development
 Jenkins is currently the dominant Continuous Integration tool
Chapter 12 - Job Types in Jenkins...................................................................................
Objectives
Key objectives of this chapter
 Different types of Jenkins job.
 Configuring Source Code Management.
 Working with Subversion
 Build Triggers.
 Schedule Build Jobs.
 Maven Build Steps
12.1 Introduction........................................................................................................
◊ Traditional Continuous Integration tasks are called "Jobs"
◊ More complicated tasks can be defined with the Pipeline, which we'll
see later.
◊ Create a new job by clicking 'New Item' from the main menu
12.2 Different types of Jenkins Items........................................................................
◊ Jenkins supports several different types of items at the top level
 Freestyle software project:
 Freestyle projects are general purpose and allow to configure any
sort of build job.
 Highly flexible and very configurable.
Chapter 12 - Job Types in Jenkins

 Maven project:
 Installed as a plugin
 Jenkins understands Maven pom files and project structures.
 Reduce the work needed to do to set up the project.
 Monitor an external job:
 Monitoring the non-interactive execution of processes, such as
cron jobs.
12.3 Different types of Jenkins Items (cont'd)...........................................................
 Multi-configuration job:
 Run same build job in many different configurations.
 Powerful feature, useful for testing an application in many
different environments.
 Folder:
 aka the CloudBees Folders Plugin
 Lets you group jobs in folders
 Creates separate namespaces for jobs
 Pipeline
 Runs an orchestration script that can have multiple steps and
span restarts
 Multibranch Pipeline
 Creates a pipeline for more than one branch in an SCM repository
12.4 Different types of Jenkins Items (cont'd)...........................................................
Chapter 12 - Job Types in Jenkins

12.5 Configuring Source Code Management(SCM)..................................................
 Monitors version control system, and checks out the latest changes as
they occur.
 Compiles and tests the most recent version of the code.
 Simply check out and build the latest version of the source code on a
regular basis.
 SCM configuration options in Jenkins are identical across all sorts of build
jobs.
 Jenkins supports Git and Subversion out of the box (default plugins)
 Integrates with a large number of other version control systems via
plugins.
Chapter 12 - Job Types in Jenkins

12.6 Working with Subversion..................................................................................
 Simply provide the corresponding Subversion URL
 Supported protocols http, svn, or file.
 Jenkins will check that the URL is valid as soon as you enter it.
 If authentication needed, Jenkins will prompt you for the corresponding
credentials automatically, and store them for any other build jobs that
access this repository.
 Fine-tune Jenkins to obtain the latest source code from your Subversion
repository by selecting an appropriate value in the Check-out Strategy
drop-down list.
 Choose check-out Strategy as “Use ‘svn update’ as much as possible,
with ‘svn revert’ before update”
 No local files are modified, though it will not remove any new files
that have been created during the build process.
 You might want other options, depending on the load on your svn
server.
12.7 Working with Subversion (cont'd).....................................................................
◊
Chapter 12 - Job Types in Jenkins

12.8 Working with Git...............................................................................................
 Git support is in a plugin, but is installed by default if you select "Install
suggested plugins" at initial setup.
 Any type of remote repository can be used:
◊ Could be https, ssh, or local
 Jenkins will check that the URL is valid as soon as you enter it.
 You can store ssh credentials or http credentials
 There are a wide variety of other "Additional Checkout Behaviors" that are
possible
12.9 Storing Credentials.............................................................................................
◊ Usually, SCM systems require login
◊ The values we use for login are called "Credentials" and can be
managed centrally
◊ As a convenience, you can add them directly from the job configuration
Chapter 12 - Job Types in Jenkins

screen
◊ Click 'Add' and then select 'Jenkins Credential Provider'
12.10 Service Accounts..............................................................................................
 As a general rule, you don't want users to put their own credentials into
Jenkins jobs or other setups
 The correct thing to do is create accounts for Jenkins
◊ i.e. "Service Accounts"
 Jenkins then has an identity that it uses to access things
 Administration personnel maintain the credentials in Jenkins for the
service account
 No users can see or download the stored credentials
12.11 Storing Credentials (cont'd)..............................................................................
◊ You can store several types of credentials
 User name/Password
 SSH Key
 Secret file
 Secret text
 X.509 Certificate
 Other plugins are available
12.12 Build Triggers..................................................................................................
 In a Freestyle build, there are three basic ways a build job can be
triggered
Chapter 12 - Job Types in Jenkins

 Start a build job once another build job has completed
 Kick off builds at periodic intervals
 Poll the SCM for changes
12.13 Schedule Build Jobs.........................................................................................
 Build job at regular intervals.
 For all scheduling tasks, Jenkins uses a cron-style syntax, consisting of
five fields separated by white space in the following format:
◊ MINUTE : Minutes within the hour (0–59)
◊ HOUR : The hour of the day (0–23) DOM
◊ DOM : The day of the month (1–31)
◊ MONTH : The month (1–12)
◊ DOW : The day of the week (0–7) where 0 and 7 are Sunday.
 There are also a few short-cuts:
◊ “*” represents all possible values for a field. For example, “* * * * *”
means “once a minute.”
◊ You can define ranges using the “M–N” notation. For example “1-5” in
the DOW field would mean “Monday to Friday.”
◊ You can use the slash notation to defined skips through a range. For
example, “*/5” in the MINUTE field would mean “every five minutes.”
Chapter 12 - Job Types in Jenkins

◊ A comma-separated list indicates a list of valid values. For example,
“15,45” in the MINUTE field would mean “at 15 and 45 minutes past
every hour.”
12.14 Polling the SCM...............................................................................................
 Poll SVN or Git server at regular intervals if any changes have been
committed.
 The more frequent the polling is, the faster the build jobs will start, and the
more accurate.
◊ But, there's more load on the SCM server
 In Jenkins, SCM polling is easy to configure, and uses the same cron
syntax we discussed previously.
12.15 Polling vs Triggers...........................................................................................
 Many SCMs can have "hooks" added
◊ For instance a script can be run when changes are pushed to a
repository
 You could use a hook to trigger a build
◊ Typical way is to use "curl" to initiate a build
◊ In the project configuration, enable "Trigger builds remotely"
 Jenkins will show you a URL that triggers the build
 Triggering may be more work to setup
 Polling may be more overhead on the SCM repository
◊ Especially if you have a large number of Jenkins jobs
 You probably need to experiment!
Chapter 12 - Job Types in Jenkins

12.16 Maven Build Steps...........................................................................................
 Jenkins has excellent Maven support, and Maven build steps are easy to
configure and very flexible.
 Select “Invoke top-level Maven targets” from the build step lists.
 Select a version of Maven to run (if you have multiple versions installed)
 Enter the Maven goals you want to run. Jenkins freestyle build jobs work
fine with both Maven 2 and Maven 3.
 The optional POM field lets you override the default location of the Maven
pom.xml file.
12.17 Summary..........................................................................................................
 Learned how Jenkins checks out the source code of a project.
 How to set-up and schedule a job.
 Setup build for Maven project.
Chapter 13 - Continuous Delivery and the Jenkins Pipeline...........................................
Objectives
Key objectives of this chapter
 Continuous Delivery
 The Jenkins Pipeline
 A Brief Introduction to Groovy
 The JenkinsFile
 Pipeline Jobs
13.1 Continuous Delivery..........................................................................................
◊ CD extends CI into deployment and operations
◊ Agile/XP speeds up the development process
 Include the Customer or Voice of the Customer
 Ensure releasable artifact after every iteration
◊ Nonetheless, Agile/XP releases fit into the standard Software
Development Life Cycle
 A release engineering and deployment process follows the
development process.
 Reflects traditional split between development and operations
Continuous Delivery

Continuous Delivery, or CD extends the idea of continuous integration into the deployment and
operations realm.

Although Agile Development and Extreme Programming seek to speed up the development process,
they originally viewed development as one piece of the traditional Software Development Life Cycle
(SDLC). XP tries to include the customer (or at least the "voice of the customer") in the development
process, and tries to make sure that we have a deliverable artifact at the end of every iteration.

Nonetheless, there's an expectation that a formal release process will follow that iteration. This model
reflects the traditional split between development and operations.

13.2 Continuous Delivery (cont'd).............................................................................
Continuous Delivery (cont'd)

Development creates a system. Operations installs and runs it. In between, we have some mysterious
release engineering process that usually includes some form of quality assurance, user acceptance
testing and management sign-offs.

13.3 DevOps and Continuous Delivery.....................................................................
◊ Managing deployments and development across horizontally-scaled
environments is difficult
 Requires tight control of the process
 Requires automation of development, deployment and monitoring
 Along with the technologies of virtualization, cloud, etc.
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

◊ This is the central theme of DevOps - Integrated provision of services
using appropriate technology and processes
◊ Deploy software as fast as we create it, while maintaining quality, trace-
ability and accountability
DevOps and Continuous Delivery

Managing application deployments and rapid application development across these sophisticated,
horizontally-scaled environments requires tight control of the process and significant automation, as
reflected in the "DevOps" movement. Much of this effort is aimed at being able to deploy software as
fast as we develop it, while maintaining quality, trace-ability, and accountability.

13.4 Continuous Delivery Challenges........................................................................
◊ More than one department/group involved, not just Developers
 QA, Compliance, Business Customers, etc
◊ CI job takes a few minutes, CD process could extend over days
 Could also include human input, manual tests, acceptance tests, etc
◊ Extended cycle means we have multiple process instances "in flight"
 "Version 6" part-way through User Acceptance Testing, while work
continues on "Version 7"
◊ Multiple resources and test/deployment environments involved
 "Version 6" goes on to Performance Validation
 "Version 7" moves into User Acceptance Testing
 Meanwhile, development gets going on "Version 8"
Continuous Delivery Challenges

Continuous Delivery extends the ideas of Continuous Integration to cover the release engineering
process and deployment of software into the production operating environment.

Chapter 13 - Continuous Delivery and the Jenkins Pipeline

From an automation perspective, things change a little when we look to Continuous Delivery.

There is probably more than one group involved. Not just development, but perhaps product
management, quality assurance, regulatory compliance and others.
Whereas CI can be automated to be essentially a batch job, taking at most a few minutes, the
release engineering process followed by deployment may take days.
Because of the extended cycle, we are more likely to have multiple instances of the process "in
flight" at any given time.
The multiple instances of the release process are likely to include multiple resources and
deployment environments.
13.5 Continuous Delivery with Jenkins.....................................................................
◊ Jenkins has always been useful for this
 A job completed successfully can trigger another job
 Jobs can be run on different machines
 Parameterized jobs can gather information from users
 Plugins can manage deployment
◊ Workflow processing has been difficult though
 Builds in-process don't persist across restart
 No logic in linking jobs
 No unified user interface
 Job definitions are not in Version Control
◊ Solution: The Pipeline Plugin
Continuous Delivery with Jenkins

Jenkins has always been capable of performing some of the work in a Continuous Delivery system.

We can have one job trigger another job. With distributed Jenkins, we can have different jobs done on
different machines. Parameterized jobs can gather information from users. Jenkins plugins can be
used to manage deployments and so on. But up until recently, there hasn't been a way to really
represent that the release engineering activities form a business process, with the usual elements of a
workflow processor. Also, it hasn't been possible to do logic in the selection and execution of jobs and

Chapter 13 - Continuous Delivery and the Jenkins Pipeline

processes.

In other words, Jenkins has handled Continuous Integration admirably, but Continuous Delivery has
been a challenge, mainly because the process of Continuous Delivery has such a longer duration than a
typical Continuous Integration job

The Jenkins Pipeline plugin (and associated plugins) is intended to address these challenges.

13.6 The Pipeline Plugin............................................................................................
◊ Represents a workflow
◊ More like a business process in SOA
 whereas a "Job" is more like a "Service Operation"
◊ Define a process and then execute an "instance"
◊ Completion of the process can span more than one machine
◊ Process has "State"
 "where are we in the process"
 Process variables
◊ State is stored persistently
 Also distributed when the build uses a different machine
13.7 The Pipeline Plugin (cont'd)...............................................................................
◊ Steps can be executed conditionally
◊ Can have explicit parallelism
 And can span machines
◊ Definition of Pipeline can be stored in Version Control
 Including all the steps that would make traditional "jobs"
◊ User Interface
 lets us see multiple instances
 See processes that span distributed installations
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

 Interact with the process (input and output)
13.8 Defining a Pipeline.............................................................................................
◊ The pipeline is defined by a script written in the Groovy programming
language
 http://groovy-lang.org
◊ The script defines "steps" that the Pipeline plugin executes
◊ Steps:
 built-in steps like "checkout" , "sh" or "bat"
 Calls to plugins
 Calls to existing jobs
13.9 A Pipeline Example............................................................................................
node {
stage 'Checkout'
checkout scm
stage 'Build'
bat 'nuget restore SolutionName.sln'
bat "\"${tool 'MSBuild'}\" SolutionName.sln"
stage 'Archive'
archive 'ProjectName/bin/Release/**'
}
13.10 Pipeline Example (cont'd)................................................................................
◊ 'node' indicates a section that should be run on an Agent machine
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

◊ 'stage' defines a pipeline stage
 for presentation in the UI
◊ 'checkout' invokes the SCM plugin to checkout a copy of the project on
the node in question
 Note: this file would be stored in version control and checked-out by
the Jenkins master. 'checkout' is checking out the same project on
the execution node
◊ 'bat' runs a Windows batch file
◊ 'archive' stores the build results
13.11 Parallel Execution............................................................................................
◊ Sections of the pipeline can be executed in parallel
def labels = ['precise', 'trusty'] // labels for
Jenkins node types we will build on
def builders = [:]
for (x in labels) {
def label = x // Need to bind the label variable
before the closure - can't do 'for (label in
labels)'
// Create a map to pass in to the 'parallel'
step so we can fire all the builds at once
builders[label] = {
node(label) {
// build steps that should happen on all
nodes go here
}
}
}
parallel builders
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

13.12 Creating a Pipeline...........................................................................................
◊ Various ways
 From the UI, like a Job
 Enter pipeline script into the web interface
 This is nice because of syntax help available
 In a "Jenkinsfile"
 Stored in version control
 Could be in the same repository as a project, or in its own
repository
 Commonly-used scripts and functions can be stored in a "Global
Library"
 Jenkins runs an instance of 'Git' to let you push global libraries
that are then available to all Pipeline scripts.
 Libraries can be stored in the project and loaded as needed.
13.13 Invoking the Pipeline.......................................................................................
◊ The pipeline shows up just like a regular Jenkins job
 It can be invoked manually, at a predefined interval, or based on SCM
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

polling
◊ Just like a regular job
13.14 Interacting with the Pipeline............................................................................
◊ Stages in the pipeline appear on the user interface
◊ In case of input required or output, these appear on the UI
13.15 Pipeline vs Traditional Jobs.............................................................................
◊ In the long term, we expect that use of traditional (config.xml) jobs will
be replaced by Pipeline jobs
◊ 'config.xml' is not stored in version control
 It is possible to manually store it, but Jenkins doesn't know anything
about versioning the config.xml
◊ Libraries allow the same process to be applied to multiple jobs
◊ Plugins like the "BitBucket Branch Source Plugin" and the "GitHub
Branch Source Plugin" let administrators basically apply the same job
Chapter 13 - Continuous Delivery and the Jenkins Pipeline

setup to all the repositories in a given organization
 Under this practice, you get a CI job/jobs automatically when the
repository is created
13.16 Conclusion........................................................................................................
◊ The Pipeline plugin turns Jenkins into an Orchestration system
◊ Continuous Delivery processes may span extended time periods
◊ Pipeline definition is in the form of a Groovy script
◊ The Jenkins UI lets you interact with the Pipeline